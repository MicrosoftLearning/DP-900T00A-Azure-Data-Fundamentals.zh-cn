---
ms.openlocfilehash: 05bea0332c8376e66d4aed62eab42a50c744536d
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050797"
---
# <a name="microsoft-authentication-library-for-node-msal-node"></a>用于 Node 的 Microsoft 身份验证库 (msal-node)

[![npm 版本](https://img.shields.io/npm/v/@azure/msal-node.svg?style=flat)](https://www.npmjs.com/package/@azure/msal-node/)[![npm 版本](https://img.shields.io/npm/dm/@azure/msal-node.svg)](https://nodei.co/npm/@azure/msal-node/)[![覆盖状态](https://coveralls.io/repos/github/AzureAD/microsoft-authentication-library-for-js/badge.svg?branch=dev)](https://coveralls.io/github/AzureAD/microsoft-authentication-library-for-js?branch=dev)

| <a href="https://docs.microsoft.com/azure/active-directory/develop/guidedsetups/active-directory-javascriptspa" target="_blank">入门</a> | <a href="https://aka.ms/aaddevv2" target="_blank">AAD 文档</a> | <a href="https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_node.html" target="_blank">库参考</a> |
| --- | --- | --- |

目前 `msal-node` 正在开发中，请[在此处](https://github.com/AzureAD/microsoft-authentication-library-for-js/projects/4)跟踪项目进度。 本文档也在编写中，将会随着 `alpha` 补丁的发布而更改。 建议不要在生产环境中使用它。

1. [关于](#about)
2. [常见问题](#faq)
3. [发行版本](#releases)
4. [先决条件](#prerequisites)
5. [安装](#installation)
6. [使用情况](#usage)
7. [示例](#samples)
8. [生成库](#build-and-test)
9. [安全报告](#security-reporting)
10. [许可证](#license)
11. [行为准则](#we-value-and-adhere-to-the-microsoft-open-source-code-of-conduct)

## <a name="about"></a>关于

MSAL Node 支持应用程序通过 [Azure AD B2C](https://docs.microsoft.com/en-us/azure/active-directory-b2c/active-directory-b2c-overview#identity-providers) 服务使用 [Azure AD](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-overview) 工作和学校帐户 (AAD)、Microsoft 个人帐户 (MSA)、社交标识提供者（Facebook、Google、LinkedIn 等）、Microsoft 帐户等对用户进行身份验证。 它还支持应用获取令牌以访问 [Microsoft Cloud](https://www.microsoft.com/enterprise) 服务，例如 [Microsoft Graph](https://graph.microsoft.io)。


### <a name="oauth20-grant-types-supported"></a>支持的 OAuth2.0 授权类型：

当前 alpha 版本支持以下令牌获取方式：

#### <a name="public-client"></a>公共客户端：
- 使用 [PKCE](https://oauth.net/2/pkce/) 的[授权代码授予](https://oauth.net/2/grant-types/authorization-code/)
- [设备代码授予](https://oauth.net/2/grant-types/device-code/)
- [刷新令牌授予](https://oauth.net/2/grant-types/refresh-token/)
- [无提示流](https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-acquire-cache-tokens#acquiring-tokens-silently-from-the-cache)

#### <a name="confidential-client"></a>机密客户端：
- 使用客户端凭据的[授权代码授予](https://oauth.net/2/grant-types/authorization-code/)
- [刷新令牌授予](https://oauth.net/2/grant-types/refresh-token/)
- [无提示流](https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-acquire-cache-tokens#acquiring-tokens-silently-from-the-cache)
- [客户端凭据授予](https://oauth.net/2/grant-types/client-credentials/)
- [代理流](https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow)

[即将推出] 我们计划在将来添加对以下内容的支持：
- [集成 Windows 身份验证流](https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-authentication-flows#integrated-windows-authentication)
- [用户名和密码流](https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-authentication-flows#usernamepassword)

有关 Microsoft 身份验证库一般支持的不同授权类型的更多详细信息，请参阅[此处](https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-authentication-flows)。

### <a name="scenarios-supported"></a>支持的方案：

此库支持的方案包括：
- 用于调用 Web API 的 桌面应用
- 调用 Web API 的 Web 应用
- 调用 Web API 的 Web API
- 守护程序应用

有关方案以及映射到其中每个方案的身份验证流的更多详细信息，请参阅[此处](https://docs.microsoft.com/en-us/azure/active-directory/develop/authentication-flows-app-scenarios)。

## <a name="faq"></a>常见问题解答

[请参阅](https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-node/docs/faq.md)。

## <a name="prerequisites"></a>先决条件

使用 `@azure/msal-node` 之前，需要在 Azure 门户中注册应用：

- [应用注册](https://docs.microsoft.com/en-us/graph/auth-register-app-v2)

## <a name="installation"></a>安装

### <a name="via-npm"></a>通过 NPM：
```javascript
npm install @azure/msal-node
```
##  <a name="usage"></a>使用情况

### <a name="msal-basics"></a>MSAL 基础知识
- [了解公共客户端与机密客户端之间的差异](https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-client-applications)
- [初始化公共客户端应用程序](https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-node/docs/initialize-public-client-application.md)
- [初始化机密客户端应用程序](https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-node/docs/initialize-confidential-client-application.md)
- [配置](https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-node/docs/configuration.md)
- [请求](https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-common/docs/request.md)
- [响应](https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-common/docs/response.md)

## <a name="samples"></a>示例
存储库中包含多个[示例](https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/samples/msal-node-samples)，这些示例使用 MSAL Node 获取令牌。 这些示例目前用于手动测试，并不是最佳做法的参考，因此请进行判断，不要盲目将此代码复制到任何生产应用程序。

- [auth-code](https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/samples/msal-node-samples/standalone-samples/auth-code)：使用 OAuth2.0 授权代码流的 Express 应用。
- [device-code](https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/samples/msal-node-samples/standalone-samples/device-code)：使用 OAuth 2.0 设备代码流的命令行应用。
- [refresh-token](https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/samples/msal-node-samples/standalone-samples/refresh-token)：：使用 OAuth 2.0 刷新流的命令行应用。
- [silent-flow](https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/samples/msal-node-samples/standalone-samples/silent-flow)：Express 应用使用 OAuth2.0 授权代码流来获取令牌并将其存储在令牌缓存中，无提示流使用令牌缓存中的令牌。
- [client-credentials](https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/samples/msal-node-samples/standalone-samples/client-credentials)：守护程序应用使用 Oauth 2.0 客户端凭据授权来获取令牌。
- [on-behalf-of](https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/samples/msal-node-samples/standalone-samples/on-behalf-of)：Web 应用程序使用 Oauth 2.0 身份验证代码流来获取 Web API 的令牌。 Web API 验证令牌，并代表在 Web 应用程序中进行身份验证的用户调用 Microsoft Graph。
- [msal-node-extensions](https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/extensions/samples/msal-node-extensions)：使用授权代码流获取令牌和 [msal-extensions](https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/extensions/) 库，以将 MSAL 内存中令牌缓存写入磁盘。

## <a name="build-and-test"></a>生成和测试

- 如果尚未安装 [lerna](https://github.com/lerna/lerna)，请运行 `npm install -g lerna`
- 从 `microsoft-authentication-library-for-js.git` 内的任意位置运行 `lerna bootstrap`。
- 导航到 `microsoft-authentication-library-for-js/lib/msal-common` 并运行 `npm run build`
- 导航到 `microsoft-authentication-library-for-js/lib/msal-node` 并运行 `npm run build`

```javascript
// to link msal-node and msal-common packages
lerna bootstrap

// Change to the msal-node package directory
cd lib/msal-common/

// To run build only for node package
npm run build

// Change to the msal-node package directory
cd lib/msal-node/

// To run build only for node package
npm run build
```

### <a name="local-development"></a>本地开发
下面是你可能发现有用的命令列表：

#### `npm run build:modules:watch`
在开发/监视模式下运行项目。 项目将根据更改重新生成。 TSDX 有一个特殊的记录器，方便你使用。 为了与 VS Code 的“问题”选项卡兼容，错误消息已整齐打印并格式化。如果你进行了编辑，该库将会重新生成。

#### `npm run build`
将包捆绑到 `dist` 文件夹。
包经过优化，并与汇总捆绑为多种格式（CommonJS、UMD 和 ES 模块）。

#### `lerna bootstrap`
如果要在开发/监视模式下运行项目，或已在 `msal-common` 中进行了更改，并且需要在整个项目中反映这些更改，请运行 `lerna bootstrap` 以链接所有符号。 请注意，`npm install` 将取消链接所有代码，因此建议在安装后运行 `lerna bootstrap`。

#### `npm run lint`
使用 Prettier 运行 eslint

#### <a name="npm-test-npm-run-testcoverage-npm-run-testwatch"></a>`npm test`, `npm run test:coverage`, `npm run test:watch`
在交互模式下运行测试观察程序 (Jest)。
默认情况下，运行与自上次提交以来更改的文件相关的测试。
通过添加标志 --coverage 来生成代码覆盖率。 无需额外设置。 Jest 可以从整个项目（包括未经测试的文件）收集代码覆盖率信息。

## <a name="security-reporting"></a>安全报告

如果发现我们的库或服务存在安全问题，请向 [secure@microsoft.com](mailto:secure@microsoft.com) 报告，并提供尽可能多的详细信息。 你的提交可能有资格通过 [Microsoft 赏金](http://aka.ms/bugbounty)计划获得赏金。 请不要将安全问题发布到 GitHub 问题或任何其他公共站点。 我们在收到信息后会尽快与你取得联系。 建议发生安全事件时获取相关通知，方法是访问 [此页](https://technet.microsoft.com/security/dd252948) 并订阅“安全公告通知”。

## <a name="license"></a>许可

版权所有 (c) Microsoft Corporation。  保留所有权利。 根据 MIT 许可证获得许可。

## <a name="we-value-and-adhere-to-the-microsoft-open-source-code-of-conduct"></a>我们重视并遵守 Microsoft 开源行为准则

此项目采用了 [Microsoft 开放源代码行为准则](https://opensource.microsoft.com/codeofconduct/)。 有关详细信息，请参阅[行为准则常见问题](https://opensource.microsoft.com/codeofconduct/faq/)，或如果有任何其他问题或意见，请与 [opencode@microsoft.com](mailto:opencode@microsoft.com) 联系。

