---
ms.openlocfilehash: 0dad0f9e52c6ad7304b11c25c495ab90d49a7d98
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050882"
---
# <a name="debug"></a>debug
[![生成状态](https://travis-ci.org/visionmedia/debug.svg?branch=master)](https://travis-ci.org/visionmedia/debug)  [![覆盖状态](https://coveralls.io/repos/github/visionmedia/debug/badge.svg?branch=master)](https://coveralls.io/github/visionmedia/debug?branch=master)  [![Slack](https://visionmedia-community-slackin.now.sh/badge.svg)](https://visionmedia-community-slackin.now.sh/) [![OpenCollective](https://opencollective.com/debug/backers/badge.svg)](#backers)
[![OpenCollective](https://opencollective.com/debug/sponsors/badge.svg)](#sponsors)

<img width="647" src="https://user-images.githubusercontent.com/71256/29091486-fa38524c-7c37-11e7-895f-e7ec8e1039b6.png">

一个模仿 Node.js 核心调试技术的小型 JavaScript 调试实用工具。 适用于 Node.js 和 Web 浏览器。

## <a name="installation"></a>安装

```bash
$ npm install debug
```

## <a name="usage"></a>使用情况

`debug`公开一个函数；只需将模块的名传递给这个函数，它将返回 `console.error` 的修饰版本，以便将调试语句传递给它。 这样，就可以切换模块不同部分以及整个模块的调试输出。

示例 [app.js](./examples/node/app.js)：

```js
var debug = require('debug')('http')
  , http = require('http')
  , name = 'My App';

// fake app

debug('booting %o', name);

http.createServer(function(req, res){
  debug(req.method + ' ' + req.url);
  res.end('hello\n');
}).listen(3000, function(){
  debug('listening');
});

// fake worker of some kind

require('./worker');
```

示例 [worker.js](./examples/node/worker.js)：

```js
var a = require('debug')('worker:a')
  , b = require('debug')('worker:b');

function work() {
  a('doing lots of uninteresting work');
  setTimeout(work, Math.random() * 1000);
}

work();

function workb() {
  b('doing some work');
  setTimeout(workb, Math.random() * 2000);
}

workb();
```

然后使用 `DEBUG` 环境变量根据空格或逗号分隔的名称进行启用。

下面是一些示例：

<img width="647" alt="screen shot 2017-08-08 at 12 53 04 pm" src="https://user-images.githubusercontent.com/71256/29091703-a6302cdc-7c38-11e7-8304-7c0b3bc600cd.png">
<img width="647" alt="screen shot 2017-08-08 at 12 53 38 pm" src="https://user-images.githubusercontent.com/71256/29091700-a62a6888-7c38-11e7-800b-db911291ca2b.png">
<img width="647" alt="screen shot 2017-08-08 at 12 53 25 pm" src="https://user-images.githubusercontent.com/71256/29091701-a62ea114-7c38-11e7-826a-2692bedca740.png">

#### <a name="windows-command-prompt-notes"></a>Windows 命令提示符笔记

##### <a name="cmd"></a>CMD

在 Windows 上使用 `set` 命令设置环境变量。

```cmd
set DEBUG=*,-not_this
```

示例：

```cmd
set DEBUG=* & node app.js
```

##### <a name="powershell-vs-code-default"></a>PowerShell（VS Code 默认）

PowerShell 使用不同的语法来设置环境变量。

```cmd
$env:DEBUG = "*,-not_this"
```

示例：

```cmd
$env:DEBUG='app';node app.js
```

然后，像往常一样运行要调试的程序。

npm 脚本示例：
```js
  "windowsDebug": "@powershell -Command $env:DEBUG='*';node app.js",
```

## <a name="namespace-colors"></a>命名空间颜色

每个调试实例都有基于其命名空间名称为其生成的颜色。
这有助于直观分析调试输出以确定调试行所属的调试实例。

#### <a name="nodejs"></a>Node.js

在 Node.js 中，stderr 为 TTY 时启用颜色。 还应该在调试的同时安装 [`supports-color`](https://npmjs.org/supports-color) 模块，否则调试将仅使用少量基本颜色。

<img width="521" src="https://user-images.githubusercontent.com/71256/29092181-47f6a9e6-7c3a-11e7-9a14-1928d8a711cd.png">

#### <a name="web-browser"></a>Web 浏览器

在了解 `%c` 格式选项的“Web Inspector”上也启用了颜色。 这些是 WebKit Web 检查器、Firefox（[自版本 31 起](https://hacks.mozilla.org/2014/05/editable-box-model-multiple-selection-sublime-text-keys-much-more-firefox-developer-tools-episode-31/)）以及适用于 Firefox 的 Firebug 插件（任何版本）。

<img width="524" src="https://user-images.githubusercontent.com/71256/29092033-b65f9f2e-7c39-11e7-8e32-f6f0d8e865c1.png">


## <a name="millisecond-diff"></a>毫秒差异

主动开发应用程序时，查看在一次 `debug()` 调用和下一次调用之间花费的时间可能很有用。 例如，假设在请求资源之前和之后调用 `debug()`，“+NNNms”将显示两次调用之间花费的时间。

<img width="647" src="https://user-images.githubusercontent.com/71256/29091486-fa38524c-7c37-11e7-895f-e7ec8e1039b6.png">

如果 stdout 不是 TTY，则使用 `Date#toISOString()`，使其更有助于记录调试信息，如下所示：

<img width="647" src="https://user-images.githubusercontent.com/71256/29091956-6bd78372-7c39-11e7-8c55-c948396d6edd.png">


## <a name="conventions"></a>约定

如果在一个或多个库中使用它，则应使用库的名称，以便开发人员可以根据需要切换调试，而无需猜测名称。 如果有多个调试程序，则应使用库名称为其添加前缀，并使用“:”分隔功能。 例如，Connect 中的“bodyParser”将为“connect:bodyParser”。  如果在名称末尾附加“*”，则无论 DEBUG 环境变量的设置如何，都将始终启用它。  然后，可以将其用于正常输出和调试输出。

## <a name="wildcards"></a>通配符

`*` 字符可用作通配符。 例如，假设你的库具有名为“connect:bodyParser”、“connect:compress”、“connect:session”的调试程序，而不是使用 `DEBUG=connect:bodyParser,connect:compress,connect:session` 列出这三个调试程序，则只需执行 `DEBUG=connect:*`，或者仅使用 `DEBUG=*` 使用此模块运行所有内容。

还可以通过使用“-”字符作为前缀来排除特定的调试程序。
例如，`DEBUG=*,-connect:*` 将包括除以“connect:”开头的调试程序之外的所有调试程序。

## <a name="environment-variables"></a>环境变量

通过 Node.js 运行时，可以设置一些环境变量来更改调试日志记录的行为：

| 名称      | 目的                                         |
|-----------|-------------------------------------------------|
| `DEBUG`   | 启用/禁用特定的调试命名空间。 |
| `DEBUG_HIDE_DATE` | 隐藏调试输出（非 TTY）的日期。  |
| `DEBUG_COLORS`| 是否在调试输出中使用颜色。 |
| `DEBUG_DEPTH` | 对象检查深度。                    |
| `DEBUG_SHOW_HIDDEN` | 显示已检查对象的隐藏属性。 |


__注意：__ 以 `DEBUG_` 开头的环境变量最终被转换为与 `%o`/`%O` 格式化程序一起使用的 Options 对象。
请参阅 [`util.inspect()`](https://nodejs.org/api/util.html#util_util_inspect_object_options) 的 Node.js 文档
以获取完整列表。

## <a name="formatters"></a>格式化程序

调试使用 [printf-style](https://wikipedia.org/wiki/Printf_format_string) 格式。
下面是官方支持的格式化程序：

| 格式化程序 | 表示形式 |
|-----------|----------------|
| `%O`      | 将 Object 整齐打印在多行上。 |
| `%o`      | 将 Object 整齐打印在单行上。 |
| `%s`      | 字符串。 |
| `%d`      | 数字（整数和浮点数）。 |
| `%j`      | JSON。 如果参数包含循环引用，则替换为字符串“[Circular]”。 |
| `%%`      | 单个百分号 ('%')。 这不使用参数。 |


### <a name="custom-formatters"></a>自定义格式化程序

可以通过扩展 `debug.formatters` 对象来添加自定义格式化程序。
例如，如果想要添加对使用 `%h` 将缓冲区呈现为十六进制的支持，则可以执行以下操作：

```js
const createDebug = require('debug')
createDebug.formatters.h = (v) => {
  return v.toString('hex')
}

// …elsewhere
const debug = createDebug('foo')
debug('this is hex: %h', new Buffer('hello world'))
//   foo this is hex: 68656c6c6f20776f726c6421 +0ms
```


## <a name="browser-support"></a>浏览器支持

如果不想自行生成浏览器就绪脚本，可以使用 [browserify](https://github.com/substack/node-browserify) 生成，或者只需使用 [browserify-as-a-service](https://wzrd.in/)[ 生成](https://wzrd.in/standalone/debug@latest)。

调试的启用状态当前由 `localStorage` 保留。
请考虑下面所示的情况，你想要调试 `worker:a` 和 `worker:b`。 可以使用 `localStorage.debug` 进行启用：

```js
localStorage.debug = 'worker:*'
```

然后刷新页面。

```js
a = debug('worker:a');
b = debug('worker:b');

setInterval(function(){
  a('doing some work');
}, 1000);

setInterval(function(){
  b('doing some work');
}, 1200);
```


## <a name="output-streams"></a>输出流

  默认情况下 `debug` 将记录到 stderr，但可以通过重写 `log` 方法来配置每个命名空间：

示例 [stdout.js](./examples/node/stdout.js)：

```js
var debug = require('debug');
var error = debug('app:error');

// by default stderr is used
error('goes to stderr!');

var log = debug('app:log');
// set this namespace to log via console.log
log.log = console.log.bind(console); // don't forget to bind to console!
log('goes to stdout');
error('still goes to stderr!');

// set all output to go via console.info
// overrides all per-namespace log settings
debug.log = console.info.bind(console);
error('now goes to stdout via console.info');
log('still goes to stdout, but via console.info now');
```

## <a name="extend"></a>Extend
只需扩展调试程序 
```js
const log = require('debug')('auth');

//creates new debug instance with extended namespace
const logSign = log.extend('sign');
const logLogin = log.extend('login');

log('hello'); // auth hello
logSign('hello'); //auth:sign hello
logLogin('hello'); //auth:login hello
```

## <a name="set-dynamically"></a>动态设置

还可以通过调用 `enable()` 方法动态启用调试：

```js
let debug = require('debug');

console.log(1, debug.enabled('test'));

debug.enable('test');
console.log(2, debug.enabled('test'));

debug.disable();
console.log(3, debug.enabled('test'));

```

打印：   
```
1 false
2 true
3 false
```

使用情况：  
`enable(namespaces)`  
`namespaces` 可以包含由冒号和通配符分隔的模式。
   
请注意，调用 `enable()` 会完全重写以前设置的 DEBUG 变量： 

```
$ DEBUG=foo node -e 'var dbg = require("debug"); dbg.enable("bar"); console.log(dbg.enabled("foo"))'
=> false
```

`disable()`

将禁用所有命名空间。 这些函数返回当前启用（和跳过）的命名空间。 如果想要暂时禁用调试，但不知道从什么开始启用，这将非常有用。

例如：

```js
let debug = require('debug');
debug.enable('foo:*,-foo:bar');
let namespaces = debug.disable();
debug.enable(namespaces);
```

注意：不能保证字符串与初始启用字符串相同，但在语义上是相同的。

## <a name="checking-whether-a-debug-target-is-enabled"></a>检查是否启用了调试目标

创建调试实例后，可以通过检查 `enabled` 属性来确定是否启用了调试实例：

```javascript
const debug = require('debug')('http');

if (debug.enabled) {
  // do stuff...
}
```

还可以手动切换此属性以强制启用或禁用调试实例。


## <a name="authors"></a>Authors

 - TJ Holowaychuk
 - Nathan Rajlich
 - Andrew Rhyne

## <a name="backers"></a>支持者

通过每月捐款来支持我们，帮助我们继续我们的活动。 [[成为支持者](https://opencollective.com/debug#backer)]

<a href="https://opencollective.com/debug/backer/0/website" target="_blank"><img src="https://opencollective.com/debug/backer/0/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/1/website" target="_blank"><img src="https://opencollective.com/debug/backer/1/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/2/website" target="_blank"><img src="https://opencollective.com/debug/backer/2/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/3/website" target="_blank"><img src="https://opencollective.com/debug/backer/3/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/4/website" target="_blank"><img src="https://opencollective.com/debug/backer/4/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/5/website" target="_blank"><img src="https://opencollective.com/debug/backer/5/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/6/website" target="_blank"><img src="https://opencollective.com/debug/backer/6/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/7/website" target="_blank"><img src="https://opencollective.com/debug/backer/7/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/8/website" target="_blank"><img src="https://opencollective.com/debug/backer/8/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/9/website" target="_blank"><img src="https://opencollective.com/debug/backer/9/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/10/website" target="_blank"><img src="https://opencollective.com/debug/backer/10/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/11/website" target="_blank"><img src="https://opencollective.com/debug/backer/11/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/12/website" target="_blank"><img src="https://opencollective.com/debug/backer/12/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/13/website" target="_blank"><img src="https://opencollective.com/debug/backer/13/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/14/website" target="_blank"><img src="https://opencollective.com/debug/backer/14/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/15/website" target="_blank"><img src="https://opencollective.com/debug/backer/15/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/16/website" target="_blank"><img src="https://opencollective.com/debug/backer/16/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/17/website" target="_blank"><img src="https://opencollective.com/debug/backer/17/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/18/website" target="_blank"><img src="https://opencollective.com/debug/backer/18/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/19/website" target="_blank"><img src="https://opencollective.com/debug/backer/19/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/20/website" target="_blank"><img src="https://opencollective.com/debug/backer/20/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/21/website" target="_blank"><img src="https://opencollective.com/debug/backer/21/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/22/website" target="_blank"><img src="https://opencollective.com/debug/backer/22/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/23/website" target="_blank"><img src="https://opencollective.com/debug/backer/23/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/24/website" target="_blank"><img src="https://opencollective.com/debug/backer/24/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/25/website" target="_blank"><img src="https://opencollective.com/debug/backer/25/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/26/website" target="_blank"><img src="https://opencollective.com/debug/backer/26/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/27/website" target="_blank"><img src="https://opencollective.com/debug/backer/27/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/28/website" target="_blank"><img src="https://opencollective.com/debug/backer/28/avatar.svg"></a>
<a href="https://opencollective.com/debug/backer/29/website" target="_blank"><img src="https://opencollective.com/debug/backer/29/avatar.svg"></a>


## <a name="sponsors"></a>主办方

成为发起人，并在 Github 的自述文件上显示你的徽标以及指向你的网站的链接。 [[成为发起人](https://opencollective.com/debug#sponsor)]

<a href="https://opencollective.com/debug/sponsor/0/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/0/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/1/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/1/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/2/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/2/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/3/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/3/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/4/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/4/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/5/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/5/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/6/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/6/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/7/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/7/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/8/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/8/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/9/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/9/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/10/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/10/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/11/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/11/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/12/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/12/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/13/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/13/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/14/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/14/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/15/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/15/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/16/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/16/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/17/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/17/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/18/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/18/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/19/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/19/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/20/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/20/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/21/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/21/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/22/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/22/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/23/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/23/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/24/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/24/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/25/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/25/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/26/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/26/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/27/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/27/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/28/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/28/avatar.svg"></a>
<a href="https://opencollective.com/debug/sponsor/29/website" target="_blank"><img src="https://opencollective.com/debug/sponsor/29/avatar.svg"></a>

## <a name="license"></a>许可

（MIT 许可证）

版权所有 (c) 2014-2017 TJ Holowaychuk &lt;tj@vision-media.ca&gt;

特此免费授予获得该软件和相关文档文件（“软件”）副本的任何人无限制地处理软件的权利，包括但不限于使用、复制、修改、合并、发布、分发、再许可和/或出售本软件的副本，并允许提供软件的人员这样做，但须满足以下条件：

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

本软件按“原样”提供，不提供任何形式的明示或暗示担保，包括但不限于对适销性，特定目的的适用性和非侵权性的担保。
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
