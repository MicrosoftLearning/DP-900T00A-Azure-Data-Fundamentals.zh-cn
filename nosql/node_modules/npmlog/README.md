---
ms.openlocfilehash: f445a828ea5ae5cba850b910d938f10a783a7ed8
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050184"
---
# <a name="npmlog"></a>npmlog

npm 使用的记录器 util。

此记录器提供非常基本的功能。  它执行 npm 的日志记录。  它支持自定义级别和彩色输出。

默认情况下，日志将写入 stderr。  如果要将日志消息发送到流以外的输出，则可以更改 `log.stream` 成员，也可以只侦听它发出的事件，并执行所需的任何操作。

# <a name="installation"></a>安装

```console
npm install npmlog --save
```

# <a name="basic-usage"></a>基本用法

```javascript
var log = require('npmlog')

// additional stuff ---------------------------+
// message ----------+                         |
// prefix ----+      |                         |
// level -+   |      |                         |
//        v   v      v                         v
    log.info('fyi', 'I have a kitty cat: %j', myKittyCat)
```

## <a name="loglevel"></a>log.level

* {String}

要显示日志的级别。  此级别或更高级别的日志会显示。  特殊级别 `silent` 将阻止显示任何内容。

## <a name="logrecord"></a>log.record

* {Array}

已输入的所有日志消息的数组。

## <a name="logmaxrecordsize"></a>log.maxRecordSize

* {Number}

要保留的最大记录数。  如果 log.record 超过此值的 10%，则会将其减少到此值的 90%。

10% 限制的原因是，这样它不必在每个日志条目上调整大数组的大小。

## <a name="logprefixstyle"></a>log.prefixStyle

* {Object}

一个样式对象，指定前缀的样式。  （请参阅下文）

## <a name="logheadingstyle"></a>log.headingStyle

* {Object}

一个样式对象，指定标题的样式。  （请参阅下文）

## <a name="logheading"></a>log.heading

* {String} Default: ""

如果设置，则为每行开头打印的标题。

## <a name="logstream"></a>log.stream

* {Stream} Default: `process.stderr`

写入输出的流。

## <a name="logenablecolor"></a>log.enableColor()

强制对所有消息使用颜色，而不考虑输出流。

## <a name="logdisablecolor"></a>log.disableColor()

禁用所有消息的颜色。

## <a name="logenableprogress"></a>log.enableProgress()

启用日志活动旋转图标和进度栏的显示

## <a name="logdisableprogress"></a>log.disableProgress()

禁用进度栏的显示

## <a name="logenableunicode"></a>log.enableUnicode()

强制 unicode 主题用于进度栏。

## <a name="logdisableunicode"></a>log.disableUnicode()

禁用进度栏中 unicode 的使用。

## <a name="logsetgaugetemplatetemplate"></a>log.setGaugeTemplate(template)

设置用于输出进度栏的模板。 有关详细信息，请参阅[仪表文档]。

[仪表文档]: https://npmjs.com/package/gauge

## <a name="logsetgaugethemesetthemes"></a>log.setGaugeThemeset(themes)

选择主题集以从进度栏中选取主题。 有关详细信息，请参阅[仪表文档]。

## <a name="logpause"></a>log.pause()

停止向流发出消息，但不删除它们。

## <a name="logresume"></a>log.resume()

发出暂停时写入的所有缓冲消息。

## <a name="logloglevel-prefix-message-"></a>log.log(level, prefix, message, ...)

* `level` {String} 要发出消息的级别
* `prefix` {String} 字符串前缀。  设置为 "" 可跳过。
* `message...` `util.format` 的参数

在特定级别发出日志消息。

## <a name="loglevel"></a>log\[level](prefix, message, ...)

例如，

* log.silly(prefix, message, ...)
* log.verbose(prefix, message, ...)
* log.info(prefix, message, ...)
* log.http(prefix, message, ...)
* log.warn(prefix, message, ...)
* log.error(prefix, message, ...)

例如 `log.log(level, prefix, message, ...)`。  这样，每个级别都会得到一个速记，因此你可以执行 `log.info(prefix, message)`。

## <a name="logaddlevellevel-n-style-disp"></a>log.addLevel(level, n, style, disp)

* `level` {String} 级别指示器
* `n` {Number} 数值级别
* `style` {Object} 具有 fg、bg、inverse 等的对象
* `disp` {String} 输出中 `level` 的可选替换。

使用速记函数等设置新级别。

请注意，如果数字为 `Infinity`，则将级别设置为那样会导致抑制所有日志消息。  如果数字为 `-Infinity`，则显示它的唯一方法是启用所有日志消息。

## <a name="lognewitemname-todo-weight"></a>log.newItem(name, todo, weight)

* `name` {String} 可选；进度项名称。
* `todo` {Number} 可选；要完成的工作的总量。 默认值为 0。
* `weight` {Number} 可选；此项相对于其他项的权重。 默认值 1。

这会向进度跟踪器添加新 `are-we-there-yet` 项跟踪器。 返回的对象具有 `log[level]` 方法，但除此之外，是 `are-we-there-yet` `Tracker` 对象。

## <a name="lognewstreamname-todo-weight"></a>log.newStream(name, todo, weight)

这会向进度跟踪器添加新的 `are-we-there-yet` 流跟踪器。 返回的对象具有 `log[level]` 方法，但除此之外，是 `are-we-there-yet` `TrackerStream` 对象。

## <a name="lognewgroupname-weight"></a>log.newGroup(name, weight)

这会向进度跟踪器添加新的 `are-we-there-yet` 跟踪器组。 返回的对象具有 `log[level]` 方法，但除此之外，是 `are-we-there-yet` `TrackerGroup` 对象。

# <a name="events"></a>事件

事件均使用消息对象发出。

* `log` 针对所有消息发出
* `log.<level>` 针对具有 `<level>` 级别的所有消息发出。
* `<prefix>` 具有前缀的消息还会将其前缀作为事件发出。

# <a name="style-objects"></a>样式对象

样式对象可以具有以下字段：

* `fg` {String} 前景文本的颜色
* `bg` {String} 背景的颜色
* `bold`、`inverse`、`underline` {Boolean} 设置关联属性
* `bell` {Boolean} 发出噪音（这可能很烦人。）

# <a name="message-objects"></a>消息对象

每个日志事件都会通过消息对象发出，并且 `log.record` 列表包含已创建的所有日志事件。  它们具有以下字段：

* `id` {Number}
* `level` {String}
* `prefix` {String}
* `message` {String} `util.format()` 的结果
* `messageRaw` {Array} `util.format()` 的参数

# <a name="blocking-ttys"></a>阻止 TTY

我们使用 [`set-blocking`](https://npmjs.com/package/set-blocking) 设置 stderr 和 stdout 阻止（如果它们是 tty 且具有 setBlocking 调用）。
这是对 Node.js 6.x 早期版本中的一个问题的变通方法，该方法将 stderr 和 stdout 设置为在 OSX 上不阻止。 （它们始终阻止 Windows，且过去在 Linux 上不阻止。）`npmlog` 需要它们进行阻止，这样它可以允许输出 stdout 且交错 stderr。
