---
ms.openlocfilehash: aa7ddb2f2ce7709064cf5157f709fc1eff52cff7
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050781"
---
## <a name="follow-redirects"></a>遵循重定向

自动遵循重定向的 Node `http` 和 `https` 模块的直接替换。

[![npm 版本](https://img.shields.io/npm/v/follow-redirects.svg)](https://www.npmjs.com/package/follow-redirects)
[![生成状态](https://github.com/follow-redirects/follow-redirects/workflows/CI/badge.svg)](https://github.com/follow-redirects/follow-redirects/actions)
[![覆盖状态](https://coveralls.io/repos/follow-redirects/follow-redirects/badge.svg?branch=master)](https://coveralls.io/r/follow-redirects/follow-redirects?branch=master)
[![npm 下载](https://img.shields.io/npm/dm/follow-redirects.svg)](https://www.npmjs.com/package/follow-redirects)
[![GitHub 上的发起人](https://img.shields.io/static/v1?label=Sponsor&message=%F0%9F%92%96&logo=GitHub)](https://github.com/sponsors/RubenVerborgh)

`follow-redirects` 提供的 [request](https://nodejs.org/api/http.html#http_http_request_options_callback) 和 [get](https://nodejs.org/api/http.html#http_http_get_options_callback) 方法的行为与原生 [http](https://nodejs.org/api/http.html#http_http_request_options_callback) 和 [https](https://nodejs.org/api/https.html#https_https_request_options_callback) 模块中的方法相同，不同之处在于它们将无缝遵循重定向。

```javascript
const { http, https } = require('follow-redirects');

http.get('http://bit.ly/900913', response => {
  response.on('data', chunk => {
    console.log(chunk);
  });
}).on('error', err => {
  console.error(err);
});
```

可以通过 `response` 上的 `responseUrl` 属性检查最终重定向的 URL。
如果未发生重定向，`responseUrl` 则为原始请求 URL。

```javascript
const request = https.request({
  host: 'bitly.com',
  path: '/UHfDGO',
}, response => {
  console.log(response.responseUrl);
  // 'http://duckduckgo.com/robots.txt'
});
request.end();
```

## <a name="options"></a>选项
### <a name="global-options"></a>全局选项
全局选项直接在 `follow-redirects` 模块上设置：

```javascript
const followRedirects = require('follow-redirects');
followRedirects.maxRedirects = 10;
followRedirects.maxBodyLength = 20 * 1024 * 1024; // 20 MB
```

支持以下全局选项：

- `maxRedirects`（默认值：`21`）- 设置允许的最大重定向次数；如果超过，将发出错误。

- `maxBodyLength`（默认值：10MB）- 设置请求正文的最大大小；如果超过，将发出错误。

### <a name="per-request-options"></a>每个请求的选项
通过传递 `options` 对象来设置每个请求的选项：

```javascript
const url = require('url');
const { http, https } = require('follow-redirects');

const options = url.parse('http://bit.ly/900913');
options.maxRedirects = 10;
options.beforeRedirect = (options, { headers }) => {
  // Use this to adjust the request options upon redirecting,
  // to inspect the latest response headers,
  // or to cancel the request by throwing an error
  if (options.hostname === "example.com") {
    options.auth = "user:password";
  }
};
http.request(options);
```

除了 [标准 HTTP](https://nodejs.org/api/http.html#http_http_request_options_callback) 和 [HTTPS 选项](https://nodejs.org/api/https.html#https_https_request_options_callback)外，还支持以下每个请求选项：
- `followRedirects`（默认值：`true`）- 是否应遵循重定向。

- `maxRedirects`（默认值：`21`）- 设置允许的最大重定向次数；如果超过，将发出错误。

- `maxBodyLength`（默认值：10MB）- 设置请求正文的最大大小；如果超过，将发出错误。

- `beforeRedirect`（默认值：`undefined`）- 可以选择更改重定向上的请求 `options`，或通过引发错误中止请求。

- `agents`（默认值：`undefined`）- 为每个协议设置 `agent` 选项，因为 HTTP 和 HTTPS 使用不同的代理。 示例值： `{ http: new http.Agent(), https: new https.Agent() }`

- `trackRedirects`（默认值：`false`）- 是否将重定向的响应详细信息存储在响应对象的 `redirects` 数组中。


### <a name="advanced-usage"></a>高级用法
默认情况下，`follow-redirects` 将使用 [`http`](https://nodejs.org/api/http.html) 和 [`https`](https://nodejs.org/api/https.html) 的 Node.js 默认实现。
若要启用缓存和/或中间请求跟踪等功能，可能需要围绕自定义协议实现进行 `follow-redirects` 包装：

```javascript
const { http, https } = require('follow-redirects').wrap({
  http: require('your-custom-http'),
  https: require('your-custom-https'),
});
```

此类自定义协议只需要 `request` 方法的实现。

## <a name="browser-usage"></a>浏览器使用情况

由于浏览器的工作方式，`http` 和 `https` 浏览器等效项默认执行重定向。

通过以下方法要求 `follow-redirects`：
```javascript
const http = require('follow-redirects/http');
const https = require('follow-redirects/https');
```
可以轻松告知 Webpack 和好友用内置版本替换 `follow-redirect`：

```json
{
  "follow-redirects/http"  : "http",
  "follow-redirects/https" : "https"
}
```

## <a name="contributing"></a>贡献

拉取请求始终是欢迎的。 请在投入宝贵时间之前[提交问题](https://github.com/follow-redirects/follow-redirects/issues)，详细说明你的建议。 附加功能和 bug 修复应附带测试。 可以使用简单的 `npm test` 命令在本地运行测试套件。

## <a name="debug-logging"></a>调试日志记录

`follow-redirects` 使用出色的[调试](https://www.npmjs.com/package/debug)进行日志记录。 若要打开日志记录，请为此模块的调试输出设置环境变量 `DEBUG=follow-redirects`。 运行测试套件时，设置 `DEBUG=*` 查看快速服务器的输出有时也很有利。

## <a name="authors"></a>Authors

- [Ruben Verborgh](https://ruben.verborgh.org/)
- [Olivier Lalonde](mailto:olalonde@gmail.com)
- [James Talmage](mailto:james@talmage.io)

## <a name="license"></a>许可

[MIT 许可证](https://github.com/follow-redirects/follow-redirects/blob/master/LICENSE)
