---
ms.openlocfilehash: 7a40bb5c1f9bdc59490cf2a2dbf591d14b488b41
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050645"
---
# <a name="form-data-npm-modulehttpswwwnpmjscompackageform-data-join-the-chat-at-httpsgitterimform-dataform-datahttpsgitterimform-dataform-data"></a>Form-Data [![NPM 模块](https://img.shields.io/npm/v/form-data.svg)](https://www.npmjs.com/package/form-data) [![加入聊天： https://gitter.im/form-data/form-data](http://form-data.github.io/images/gitterbadge.svg)](https://gitter.im/form-data/form-data)

用于创建可读的 ```"multipart/form-data"``` 流的库。 可用于向其他 Web 应用程序提交表单和文件上传。

此库的 API 受 [XMLHttpRequest-2 FormData 接口][xhr2-fd]的启发。

[xhr2-fd]: http://dev.w3.org/2006/webapi/XMLHttpRequest-2/Overview.html#the-formdata-interface

[![Linux 版本](https://img.shields.io/travis/form-data/form-data/v3.0.1.svg?label=linux:6.x-12.x)](https://travis-ci.org/form-data/form-data)
[![MacOS 版本](https://img.shields.io/travis/form-data/form-data/v3.0.1.svg?label=macos:6.x-12.x)](https://travis-ci.org/form-data/form-data)
[![Windows 版本](https://img.shields.io/travis/form-data/form-data/v3.0.1.svg?label=windows:6.x-12.x)](https://travis-ci.org/form-data/form-data)

[![覆盖状态](https://img.shields.io/coveralls/form-data/form-data/v3.0.1.svg?label=code+coverage)](https://coveralls.io/github/form-data/form-data?branch=master)
[![依赖项状态](https://img.shields.io/david/form-data/form-data.svg)](https://david-dm.org/form-data/form-data)

## <a name="install"></a>安装

```
npm install --save form-data
```

## <a name="usage"></a>使用情况

在此示例中，我们正在构建一个包含 3 个字段的表单，其中包含一个字符串、一个缓冲区和一个文件流。

``` javascript
var FormData = require('form-data');
var fs = require('fs');

var form = new FormData();
form.append('my_field', 'my value');
form.append('my_buffer', new Buffer(10));
form.append('my_file', fs.createReadStream('/foo/bar.jpg'));
```

还可以使用 http-response 流：

``` javascript
var FormData = require('form-data');
var http = require('http');

var form = new FormData();

http.request('http://nodejs.org/images/logo.png', function(response) {
  form.append('my_field', 'my value');
  form.append('my_buffer', new Buffer(10));
  form.append('my_logo', response);
});
```

或 @mikeal 的[请求](https://github.com/request/request)流：

``` javascript
var FormData = require('form-data');
var request = require('request');

var form = new FormData();

form.append('my_field', 'my value');
form.append('my_buffer', new Buffer(10));
form.append('my_logo', request('http://nodejs.org/images/logo.png'));
```

若要将此表单提交到 Web 应用程序，请调用 ```submit(url, [callback])``` 方法：

``` javascript
form.submit('http://example.org/', function(err, res) {
  // res – response object (http.IncomingMessage)  //
  res.resume();
});

```

对于更高级的请求操作，```submit()``` 方法返回 ```http.ClientRequest``` 对象，或者你可以选择一种替代提交方法。

### <a name="custom-options"></a>自定义选项

可以提供自定义选项，例如 `maxDataSize`：

``` javascript
var FormData = require('form-data');

var form = new FormData({ maxDataSize: 20971520 });
form.append('my_field', 'my value');
form.append('my_buffer', /* something big */);
```

可在 [combined-stream](https://github.com/felixge/node-combined-stream/blob/master/lib/combined_stream.js#L7-L15) 中找到可用选项列表

### <a name="alternative-submission-methods"></a>替代提交方法

可以使用节点的 HTTP 客户端接口：

``` javascript
var http = require('http');

var request = http.request({
  method: 'post',
  host: 'example.org',
  path: '/upload',
  headers: form.getHeaders()
});

form.pipe(request);

request.on('response', function(res) {
  console.log(res.statusCode);
});
```

或者，你希望系统为你设置 `'Content-Length'` 标头：

``` javascript
form.submit('example.org/upload', function(err, res) {
  console.log(res.statusCode);
});
```

若要部分使用自定义标头和已知长度：

``` javascript
var CRLF = '\r\n';
var form = new FormData();

var options = {
  header: CRLF + '--' + form.getBoundary() + CRLF + 'X-Custom-Header: 123' + CRLF + CRLF,
  knownLength: 1
};

form.append('my_buffer', buffer, options);

form.submit('http://example.com/', function(err, res) {
  if (err) throw err;
  console.log('Done');
});
```

Form-Data 可以识别常见类型的流（```fs.readStream```、```http.response``` 和 ```mikeal's request```）并从中提取所有必需的信息，对于其他一些类型的流，你需要手动提供“文件”的相关信息：

``` javascript
someModule.stream(function(err, stdout, stderr) {
  if (err) throw err;

  var form = new FormData();

  form.append('file', stdout, {
    filename: 'unicycle.jpg', // ... or:
    filepath: 'photos/toys/unicycle.jpg',
    contentType: 'image/jpeg',
    knownLength: 19806
  });

  form.submit('http://example.com/', function(err, res) {
    if (err) throw err;
    console.log('Done');
  });
});
```

`filepath` 属性替代 `filename` 并可能包含相对路径。 这通常在[从目录上传多个文件](https://wicg.github.io/entries-api/#dom-htmlinputelement-webkitdirectory)时使用。

在边缘情况中，例如使用查询字符串向 URL 发出 POST 请求或传递 HTTP 身份验证凭据，对象可以作为第一个参数传递给 `form.submit()`：

``` javascript
form.submit({
  host: 'example.com',
  path: '/probably.php?extra=params',
  auth: 'username:password'
}, function(err, res) {
  console.log(res.statusCode);
});
```

如果需要使用 POST 请求发送自定义 HTTP 标头，可以在 `form.submit()` 的第一个参数中使用 `headers` 键：

``` javascript
form.submit({
  host: 'example.com',
  path: '/surelynot.php',
  headers: {'x-test-header': 'test-header-value'}
}, function(err, res) {
  console.log(res.statusCode);
});
```

### <a name="methods"></a>方法

- [Void append( String field, Mixed value [, Mixed options] )](https://github.com/form-data/form-data#void-append-string-field-mixed-value--mixed-options-)。
- [Headers getHeaders( [Headers userHeaders] )](https://github.com/form-data/form-data#array-getheaders-array-userheaders-)
- [String getBoundary()](https://github.com/form-data/form-data#string-getboundary)
- [Void setBoundary()](https://github.com/form-data/form-data#void-setboundary)
- [Buffer getBuffer()](https://github.com/form-data/form-data#buffer-getbuffer)
- [Integer getLengthSync()](https://github.com/form-data/form-data#integer-getlengthsync)
- [Integer getLength( function callback )](https://github.com/form-data/form-data#integer-getlength-function-callback-)
- [Boolean hasKnownLength()](https://github.com/form-data/form-data#boolean-hasknownlength)
- [Request submit( params, function callback )](https://github.com/form-data/form-data#request-submit-params-function-callback-) 
- [String toString()](https://github.com/form-data/form-data#string-tostring)

#### <a name="_void_-append-string-_field_-mixed-_value_--mixed-_options_-"></a>Void append( String field, Mixed value [, Mixed options] )
将数据追加到表单。 可以提交任何格式（字符串、整数、布尔值、缓冲区等）。 但不支持数组，需要用户将其转换为字符串。
```javascript
var form = new FormData();
form.append( 'my_string', 'my value' );
form.append( 'my_integer', 1 );
form.append( 'my_boolean', true );
form.append( 'my_buffer', new Buffer(10) );
form.append( 'my_array_as_json', JSON.stringify( ['bird','cute'] ) )
```

可以提供选项字符串或提供对象。
```javascript
// Set filename by providing a string for options
form.append( 'my_file', fs.createReadStream('/foo/bar.jpg'), 'bar.jpg' );

// provide an object.
form.append( 'my_file', fs.createReadStream('/foo/bar.jpg'), {filename: 'bar.jpg', contentType: 'image/jpeg', knownLength: 19806} );
```

#### <a name="_headers_-getheaders-headers-_userheaders_-"></a>Headers getHeaders( [Headers userHeaders] )
此方法将正确的 `content-type` 标头添加到提供的 `userHeaders` 数组中。  

#### <a name="_string_-getboundary"></a>String getBoundary()
返回 formData 的边界。 默认情况下，边界包括 26 个 `-` 后跟 24 个数字，例如：
```javascript
--------------------------515890814546601021194782
```

#### <a name="_void_-setboundarystring-_boundary_"></a>Void setBoundary(String boundary) 
设置边界字符串，替代上述默认行为。

_注意：边界必须是唯一的，并且可能不会显示在数据中。_

#### <a name="_buffer_-getbuffer"></a>Buffer getBuffer()
将完整的 formdata 请求包以缓冲区的形式返回。 可以（例如在 Axios 中）插入此缓冲区以发送多部分数据。
```javascript
var form = new FormData();
form.append( 'my_buffer', Buffer.from([0x4a,0x42,0x20,0x52,0x6f,0x63,0x6b,0x73]) );
form.append( 'my_file', fs.readFileSync('/foo/bar.jpg') );

axios.post( 'https://example.com/path/to/api',
            form.getBuffer(),
            form.getHeaders()
          )
```
**注意：** 因为输出类型为缓冲区，因此只能追加缓冲区接受的类型：字符串、缓冲区、ArrayBuffer、数组或类似数组的对象。 例如，追加 ReadStream 将会导致出错。

#### <a name="_integer_-getlengthsync"></a>Integer getLengthSync()
与 `getLength` 相同但是同步进行。

注意：getLengthSync 不计算流长度。

#### <a name="_integer_-getlength-function-_callback_-"></a>Integer getLength( function callback )
异步返回 `Content-Length`。 回调用于处理错误并在计算长度后继续
```javascript
this.getLength(function(err, length) {
  if (err) {
    this._error(err);
    return;
  }

  // add content length
  request.setHeader('Content-Length', length);

  ...
}.bind(this));
```

#### <a name="_boolean_-hasknownlength"></a>Boolean hasKnownLength()
检查所添加值的长度是否已知。

#### <a name="_request_-submit-_params_-function-_callback_-"></a>Request submit( params, function callback ) 
将表单提交到 Web 应用程序。
```javascript
var form = new FormData();
form.append( 'my_string', 'Hello World' );

form.submit( 'http://example.com/', function(err, res) {
  // res – response object (http.IncomingMessage)  //
  res.resume();
} );
```

#### <a name="_string_-tostring"></a>String toString()
返回字符串形式的表单数据。 如果要发送文件或缓冲区，请不要使用它，而是使用 `getBuffer()`。

### <a name="integration-with-other-libraries"></a>与其他库的集成

#### <a name="request"></a>请求

使用[请求](https://github.com/request/request)提交表单：

```javascript
var formData = {
  my_field: 'my_value',
  my_file: fs.createReadStream(__dirname + '/unicycle.jpg'),
};

request.post({url:'http://service.com/upload', formData: formData}, function(err, httpResponse, body) {
  if (err) {
    return console.error('upload failed:', err);
  }
  console.log('Upload successful!  Server responded with:', body);
});
```

有关详细信息，请参阅[请求自述文件](https://github.com/request/request#multipartform-data-multipart-form-uploads)。

#### <a name="node-fetch"></a>node-fetch

还可以使用 [node-fetch](https://github.com/bitinn/node-fetch) 提交表单：

```javascript
var form = new FormData();

form.append('a', 1);

fetch('http://example.com', { method: 'POST', body: form })
    .then(function(res) {
        return res.json();
    }).then(function(json) {
        console.log(json);
    });
```

#### <a name="axios"></a>axios

在 Node.js 中，可以使用 [axios](https://github.com/axios/axios) 发布文件：
```javascript
const form = new FormData();
const stream = fs.createReadStream(PATH_TO_FILE);

form.append('image', stream);

// In Node.js environment you need to set boundary in the header field 'Content-Type' by calling method `getHeaders`
const formHeaders = form.getHeaders();

axios.post('http://example.com', form, {
  headers: {
    ...formHeaders,
  },
})
.then(response => response)
.catch(error => error)
```

## <a name="notes"></a>注释

- ```getLengthSync()``` 方法不计算流的长度，解决方法是使用 ```knownLength``` 选项。
- 从 `2.x` 版本开始，FormData 不再支持 `node@0.10.x`。
- 从 `3.x` 版本开始，FormData 不再支持 `node@4.x`。

## <a name="license"></a>许可

Form-Data 在 [MIT 许可](License)下发布。
