
---
<p align="center">
  <strong>
    <a href="https://open-telemetry.github.io/opentelemetry-js-api">API 文档<a/> &nbsp;&nbsp;&bull;&nbsp;&nbsp; <a href="https://github.com/open-telemetry/opentelemetry-js/discussions">取得联系（GitHub 讨论）<a/>
  </strong>
</p>

<p align="center">
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/releases">
    <img alt="GitHub release (latest by date including pre-releases)" src="https://img.shields.io/github/v/release/open-telemetry/opentelemetry-js-api?include_prereleases&style=for-the-badge">
  </a>
  <a href="https://codecov.io/gh/open-telemetry/opentelemetry-js-api/branch/main/">
    <img alt="Codecov Status" src="https://img.shields.io/codecov/c/github/open-telemetry/opentelemetry-js-api?style=for-the-badge">
  </a>
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/blob/main/LICENSE">
    <img alt="license" src="https://img.shields.io/badge/license-Apache_2.0-green.svg?style=for-the-badge">
  </a>
  <br/>
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/docs.yaml">
    <img alt="Build Status" src="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/test.yaml/badge.svg?branch=main">
  </a>
  <a href="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/test.yaml?query=branch%3Amain">
    <img alt="Build Status" src="https://github.com/open-telemetry/opentelemetry-js-api/actions/workflows/docs.yaml/badge.svg">
  </a>
</p>

---

# <a name="opentelemetry-api-for-javascript"></a>适用于 JavaScript 的 OpenTelemetry API

[![NPM 已发布版本][npm-img]][npm-url]
[![dependencies][dependencies-image]][dependencies-url]
[![devDependencies][devDependencies-image]][devDependencies-url]

此包提供与 OpenTelemetry API 交互所需的所有内容，包括所有 TypeScript 接口、枚举和无操作实现。 它适用于在服务器和浏览器中使用。

默认情况下，此包中的方法不执行任何操作。 这意味着，无论是否注册了 SDK，库或最终用户应用程序都可以安全地调用它们。 为了生成和导出遥测数据，还需要一个 SDK，例如 [OpenTelemetry JS SDK][opentelemetry-js]。

## <a name="tracing-quick-start"></a>跟踪快速入门

### <a name="you-will-need"></a>你将需要

- 要检测的应用程序
- [OpenTelemetry JS SDK][opentelemetry-js]
- Node.js >=8.5.0（首选 14+）或与 ECMAScript 5+ 兼容的浏览器

**注意：** ECMAScript 5+ 兼容性仅针对此包。 请参考你所使用的 SDK 的文档，确定其最低 ECMAScript 版本。

**适用于库创建者的说明：** 只有最终用户需要 OpenTelemetry SDK。 如果希望在库中支持 OpenTelemetry，则只需使用 OpenTelemetry API。 有关详细信息，请阅读[跟踪文档][docs-tracing]。

### <a name="install-dependencies"></a>安装依赖项

```sh
npm install @opentelemetry/api @opentelemetry/tracing
```

### <a name="trace-your-application"></a>跟踪应用程序

若要开始跟踪，首先需要注册 SDK。 你使用的 SDK 可以提供一种方便的方法，该方法会为你调用注册方法，但如果想要直接调用它们，它们记录在此处：[sdk 注册方法][docs-sdk-registration]。

注册 SDK 后，可以开始和结束跨度。 下面是基本 SDK 注册和跟踪简单操作的简单示例。 该示例应每秒将跨度导出到控制台一次。 有关详细信息，请参阅[跟踪文档][docs-tracing]。

```javascript
const { trace }  = require("@opentelemetry/api");
const { BasicTracerProvider, ConsoleSpanExporter, SimpleSpanProcessor }  = require("@opentelemetry/tracing");

// Create and register an SDK
const provider = new BasicTracerProvider();
provider.addSpanProcessor(new SimpleSpanProcessor(new ConsoleSpanExporter()));
trace.setGlobalTracerProvider(provider);

// Acquire a tracer from the global tracer provider which will be used to trace the application
const name = 'my-application-name';
const version = '0.1.0';
const tracer = trace.getTracer(name, version);

// Trace your application by creating spans
async function operation() {
  const span = tracer.startSpan("do operation");

  // mock some work by sleeping 1 second
  await new Promise((resolve, reject) => {
    setTimeout(resolve, 1000);
  })

  span.end();
}

async function main() {
  while (true) {
    await operation();
  }
}

main();
```

## <a name="version-compatibility"></a>版本兼容性

由于 npm 安装程序和节点模块解析算法可能允许任何给定包的两个或多个副本存在于同一 `node_modules` 结构中，因此 OpenTelemetry API 利用 `global` 对象上的变量来存储全局 API。 调用 API 包中的 API 方法时，它会检查此 `global` API 是否存在，并且仅当它是兼容的 API 版本时才对它进行调用。 这意味着，如果包依赖于与最终用户使用的 API 不兼容的 OpenTelemetry API 版本，则包将收到 API 的无操作实现。

## <a name="upgrade-guidelines"></a>升级指南

### <a name="0210-to-100"></a>0.21.0 到 1.0.0

无中断性变更

### <a name="0200-to-0210"></a>0.20.0 到 0.21.0

- [#78](https://github.com/open-telemetry/opentelemetry-js-api/issues/78) `api.context.bind` 参数已反转且 `context` 现在是所需的参数。
- [#46](https://github.com/open-telemetry/opentelemetry-js-api/issues/46) Noop 类和单一实例不再导出。 若要创建 noop 跨度，建议将 `api.trace.wrapSpanContext` 与 `INVALID_SPAN_CONTEXT` 结合使用，而不是使用 `NOOP_TRACER`。

### <a name="100-rc3-to-0200"></a>1.0.0-rc.3 to 0.20.0

- 删除 `TimedEvent`（不是规范的一部分）
- `HttpBaggage` 已重命名为 `HttpBaggagePropagator`
- [#45](https://github.com/open-telemetry/opentelemetry-js-api/pull/45) `Span#context` 重命名为 `Span#spanContext`
- [#47](https://github.com/open-telemetry/opentelemetry-js-api/pull/47) `getSpan`/`setSpan`/`getSpanContext`/`setSpanContext` 移动到 `trace` 命名空间
- [#55](https://github.com/open-telemetry/opentelemetry-js-api/pull/55) `getBaggage`/`setBaggage`/`createBaggage` 移动到 `propagation` 命名空间

## <a name="useful-links"></a>有用链接

- 有关 OpenTelemetry 的详细信息，请访问：<https://opentelemetry.io/>
- 有关 OpenTelemetry JavaScript 的详细信息，请访问：<https://github.com/open-telemetry/opentelemetry-js>
- 有关此项目的帮助或反馈，请加入 [GitHub 讨论][discussions-url]

## <a name="license"></a>许可

Apache 2.0 - 有关详细信息，请参阅[许可证][license-url]。

[opentelemetry-js]: https://github.com/open-telemetry/opentelemetry-js

[discussions-url]: https://github.com/open-telemetry/opentelemetry-js/discussions
[license-url]: https://github.com/open-telemetry/opentelemetry-js-api/blob/main/LICENSE
[license-image]: https://img.shields.io/badge/license-Apache_2.0-green.svg?style=flat
[dependencies-image]: https://status.david-dm.org/gh/open-telemetry/opentelemetry-js-api.svg
[dependencies-url]: https://david-dm.org/open-telemetry/opentelemetry-js-api
[devDependencies-image]: https://status.david-dm.org/gh/open-telemetry/opentelemetry-js-api.svg?type=dev
[devDependencies-url]: https://david-dm.org/open-telemetry/opentelemetry-js-api?type=dev
[npm-url]: https://www.npmjs.com/package/@opentelemetry/api
[npm-img]: https://badge.fury.io/js/%40opentelemetry%2Fapi.svg
[docs-tracing]: https://github.com/open-telemetry/opentelemetry-js-api/blob/main/docs/tracing.md
[docs-sdk-registration]: https://github.com/open-telemetry/opentelemetry-js-api/blob/main/docs/sdk-registration.md
