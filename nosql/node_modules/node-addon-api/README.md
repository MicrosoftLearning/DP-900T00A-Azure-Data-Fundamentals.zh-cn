---
ms.openlocfilehash: 5f4ff1937c647160a418ca9c807267dc22e5e09f
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050817"
---
注意：默认分支已重命名！
master 现已更名为 main

如果有本地克隆，可以通过运行以下内容进行更新：

```shell
git branch -m master main
git fetch origin
git branch -u origin/main main
```

# <a name="node-addon-api-module"></a>**node-addon-api module**
此模块包含“仅标头 C++ 包装类”，它们在使用 C++ 时简化 Node.js 提供的基于 C 的 [Node-API](https://nodejs.org/dist/latest/docs/api/n-api.html) 的使用。 它提供开销较低的 C++ 对象模型和异常处理语义。

有三个选项可用于实现加载项：Node-API、nan 或直接使用内部 V8、libuv 和 Node.js 库。 除非需要直接访问 Node-API 未公开的功能（如 Node.js Core 中的 [C/C++ 加载项](https://nodejs.org/dist/latest/docs/api/addons.html)中所述），否则请使用 Node-API。 有关 Node-API 的详细信息，请参阅 [Node-API 的 C/C++ 加载项](https://nodejs.org/dist/latest/docs/api/n-api.html)。

Node-API 是由 Node.js 提供的 ABI 稳定 C 接口，用于生成原生加载项。 它独立于基础 JavaScript 运行时（例如 V8 或 ChakraCore），并作为 Node.js 本身的一部分进行维护。 它旨在使原生加载项免受基础 JavaScript 引擎中的更改的影响，并允许为一个版本编译的模块在更高版本的 Node.js 上运行，而无需重新编译。

`node-addon-api` 模块不是 Node.js 的一部分，它保留了 Node-API 的优点，因为它仅由内联代码组成，而内联代码仅依赖于 Node-API 提供的稳定 API。 因此，使用 node-addon-api 针对一个版本的 Node.js 生成的模块应该可以运行，而无需使用较新版本的 Node.js 重新生成。

请务必记住，其他 Node.js 接口，如 `libuv`（通过 `#include <uv.h>` 包含在项目中），在 Node.js 的主版本中 ABI 不稳定。 因此，加载项必须专门使用 Node-API 和/或 `node-addon-api` 并针对包含 Node-API 实现的 Node.js 版本生成（即 Node.js 的活动 LTS 版本），以便从跨 Node.js 主版本的 ABI 稳定性中受益。 Node.js 提供了 [ABI 稳定性指南][]，其中详细解释了 ABI 的稳定性，特别是 Node-API ABI 稳定性保证。

将新 API 添加到 Node-API 时，必须更新 node-addon-api 才能为这些新 API 提供包装器。 因此，node-addon-api 提供了允许调用方获取基础 Node-API 句柄的方法，以便直接调用 Node-API 并使用 node-addon-api 提供的对象/方法。 例如，为了能够使用 node-addon-api 尚未提供包装器的 API。

node-addon-api 公开的 API 通常用于创建和操作 JavaScript 值。 概念和操作通常对应到 ECMA262 语言规范中指定的想法。

[Node-API 资源](https://nodejs.github.io/node-addon-examples/) 为刚开始使用 Node-API 和 node-addon-api 的开发人员提供了一个很好的方向和提示。

- **[设置](#setup)**
- **[API 文档](#api)**
- **[示例](#examples)**
- **[测试](#tests)**
- **[有关原生加载项的更多资源和信息](#resources)**
- **[徽章](#badges)**
- **[行为准则](CODE_OF_CONDUCT.md)**
- **[作者](#contributors)**
- **[许可](#license)**

## <a name="current-version-321"></a>**当前版本：3.2.1**

（有关完整的更改日志，请参阅 [CHANGELOG.md](CHANGELOG.md)）

[![NPM](https://nodei.co/npm/node-addon-api.png?downloads=true&downloadRank=true)](https://nodei.co/npm/node-addon-api/) [![NPM](https://nodei.co/npm-dl/node-addon-api.png?months=6&height=1)](https://nodei.co/npm/node-addon-api/)

<a name="setup"></a>

node-addon-api 基于 [Node-API](https://nodejs.org/api/n-api.html)，支持使用不同的 Node-API 版本。
这允许用它生成的加载项在支持目标 Node-API 版本的 Node.js 版本中运行。
但是，node-addon-api 支持模型仅支持活动 LTS Node.js 版本。 这意味着，每年都会有一个新的主版本删除对已停止服务的 Node.js LTS 版本的支持。

当前版本的 node-addon-api 支持的最旧的 Node.js 版本是 Node.js 10.x。

## <a name="setup"></a>设置
  - [安装和使用](doc/setup.md)
  - [node-gyp](doc/node-gyp.md)
  - [cmake-js](doc/cmake-js.md)
  - [转换工具](doc/conversion-tool.md)
  - [检查器工具](doc/checker-tool.md)
  - [Generator](doc/generator.md)
  - [预生成工具](doc/prebuild_tools.md)

<a name="api"></a>

### <a name="api-documentation"></a>**API 文档**

下面是 node-addon-api 的文档。

 - [完整类层次结构](doc/hierarchy.md)
 - [加载项结构](doc/addon.md)
 - 数据类型：
    -               Env
    - [CallbackInfo](doc/callbackinfo.md)
    - [引用](doc/reference.md)
    - [值](doc/value.md)
        - [名称](doc/name.md)
            - [符号](doc/symbol.md)
            - [字符串](doc/string.md)
        - [数字](doc/number.md)
        - [Date](doc/date.md)
        - [BigInt](doc/bigint.md)
        - [布尔值](doc/boolean.md)
        - [外部](doc/external.md)
        - [Object](doc/object.md)
            - 数组 
            - [ObjectReference](doc/object_reference.md)
    - [PropertyDescriptor](doc/property_descriptor.md)
    - 函数
        - [FunctionReference](doc/function_reference.md)
    - [ObjectWrap](doc/object_wrap.md)
        - [ClassPropertyDescriptor](doc/class_property_descriptor.md)
    - [Buffer](doc/buffer.md)
    - [ArrayBuffer](doc/array_buffer.md)
    - [TypedArray](doc/typed_array.md)
      - [TypedArrayOf](doc/typed_array_of.md)
    - [DataView](doc/dataview.md)
 - [错误处理](doc/error_handling.md)
    - [错误](doc/error.md)
      - [TypeError](doc/type_error.md)
      - [RangeError](doc/range_error.md)
 - [对象生存期管理](doc/object_lifetime_management.md)
    - [HandleScope](doc/handle_scope.md)
    - [EscapableHandleScope](doc/escapable_handle_scope.md)
 - [内存管理](doc/memory_management.md)
 - [异步操作](doc/async_operations.md)
    - [AsyncWorker](doc/async_worker.md)
    - [AsyncContext](doc/async_context.md)
    - [AsyncWorker 变体](doc/async_worker_variants.md)
 - [线程安全函数](doc/threadsafe.md)
    - [ThreadSafeFunction](doc/threadsafe_function.md)
    - [TypedThreadSafeFunction](doc/typed_threadsafe_function.md)
 - [承诺](doc/promises.md)
 - [版本管理](doc/version_management.md)

<a name="examples"></a>

### <a name="examples"></a>**示例**

你不熟悉 node-addon-api？ 查看我们的 [示例](https://github.com/nodejs/node-addon-examples)

- **[Hello World](https://github.com/nodejs/node-addon-examples/tree/HEAD/1_hello_world/node-addon-api)**
- **[将参数传递给函数](https://github.com/nodejs/node-addon-examples/tree/HEAD/2_function_arguments/node-addon-api)**
- **[回调](https://github.com/nodejs/node-addon-examples/tree/HEAD/3_callbacks/node-addon-api)**
- **[对象工厂](https://github.com/nodejs/node-addon-examples/tree/HEAD/4_object_factory/node-addon-api)**
- **[函数工厂](https://github.com/nodejs/node-addon-examples/tree/HEAD/5_function_factory/node-addon-api)**
- **[包装 C++ 对象](https://github.com/nodejs/node-addon-examples/tree/HEAD/6_object_wrap/node-addon-api)**
- **[包装对象的工厂](https://github.com/nodejs/node-addon-examples/tree/HEAD/7_factory_wrap/node-addon-api)**
- **[传递周围的包装对象](https://github.com/nodejs/node-addon-examples/tree/HEAD/8_passing_wrapped/node-addon-api)**

<a name="tests"></a>

### <a name="tests"></a>**测试**

要运行 node-addon-api 测试，请执行以下操作：

```
npm install
npm test
```

避免测试 API 运行中已弃用的部分
```
npm install
npm test --disable-deprecated
```

运行针对特定版本的 Node-API 运行的测试
```
npm install
export NAPI_VERSION=X
npm test --NAPI_VERSION=X
```

其中 X 是要针对的 Node-API 版本。

### <a name="debug"></a>**调试**

使用 `--debug` 选项运行 node-add -api 测试：

```
npm run-script dev
```

如果想要更快地生成，可以使用以下选项：

```
npm run-script dev:incremental
```

看一看并从我们的[测试套件](https://github.com/nodejs/node-addon-api/tree/HEAD/test)获得启发

### <a name="benchmarks"></a>**基准**

可以使用以下命令运行可用的基准：

```
npm run-script benchmark
```

有关运行和添加基准的详细信息，请参阅[基准/README.md](benchmark/README.md)。

<a name="resources"></a>

### <a name="more-resource-and-info-about-native-addons"></a>**有关原生加载项的更多资源和信息**
- **[C++ 加载项](https://nodejs.org/dist/latest/docs/api/addons.html)**
- **[Node-API](https://nodejs.org/dist/latest/docs/api/n-api.html)**
- **[Node-API - 用于原生模块的下一代 Node API](https://youtu.be/-Oniup60Afs)**
- **[如何将领域 JavaScript 从 NAN 迁移到 Node-API](https://developer.mongodb.com/article/realm-javascript-nan-to-n-api)**

由于 node-addon-api 的核心任务是将普通的 C Node-API 公开为 C++ 包装器，因此在开发具有 n-api/node-addon-api 的 Node.js 加载项时帮助提供更方便模式的工具，可作为独立包发布到 NPM。 还建议使用 `node-addon-api` 标记这些包，以向社区提供更多的可见性。

指向 NPM 搜索的快速链接：[keywords:node-addon-api](https://www.npmjs.com/search?q=keywords%3Anode-addon-api)。

<a name="other-bindings"></a>

### <a name="other-bindings"></a>**其他绑定**

- **[napi-rs](https://napi.rs)** - (`Rust`)

<a name="badges"></a>

### <a name="badges"></a>**徽章**

建议使用徽章来指示模块所需的 Node-API 的最低版本。 这有助于确定支持哪些 Node.js 主版本。 加载项维护者可以参考 [Node-API 支持矩阵][]来确定哪些 Node.js 版本提供给定的 Node-API 版本。 以下徽章可用：

![Node-API v1 徽章](https://github.com/nodejs/abi-stable-node/blob/doc/assets/Node-API%20v1%20Badge.svg)
![Node-API v2 徽章](https://github.com/nodejs/abi-stable-node/blob/doc/assets/Node-API%20v2%20Badge.svg)
![Node-API v3 徽章](https://github.com/nodejs/abi-stable-node/blob/doc/assets/Node-API%20v3%20Badge.svg)
![Node-API v4 徽章](https://github.com/nodejs/abi-stable-node/blob/doc/assets/Node-API%20v4%20Badge.svg)
![Node-API v5 徽章](https://github.com/nodejs/abi-stable-node/blob/doc/assets/Node-API%20v5%20Badge.svg)
![Node-API v6 徽章](https://github.com/nodejs/abi-stable-node/blob/doc/assets/Node-API%20v6%20Badge.svg)
![Node-API v7 徽章](https://github.com/nodejs/abi-stable-node/blob/doc/assets/Node-API%20v7%20Badge.svg)
![Node-API v8 徽章](https://github.com/nodejs/abi-stable-node/blob/doc/assets/Node-API%20v8%20Badge.svg)
![Node-API 试验版本徽章](https://github.com/nodejs/abi-stable-node/blob/doc/assets/Node-API%20Experimental%20Version%20Badge.svg)

## <a name="contributing"></a>**供稿**

我们喜欢社区对 node-addon-api 的贡献！
有关扩展本模块的的理念的详细信息，请参阅 [CONTRIBUTING.md](CONTRIBUTING.md) 。

<a name="contributors"></a>

## <a name="team-members"></a>团队成员

### <a name="active"></a>可用
| 名称                | GitHub 链接                                           |
| ------------------- | ----------------------------------------------------- |
| Anna Henningsen     | [addaleax](https://github.com/addaleax)               |
| Chengzhong Wu       | [legendecas](https://github.com/legendecas)           |
| Gabriel Schulhof    | [gabrielschulhof](https://github.com/gabrielschulhof) |
| Jim Schlight        | [jschlight](https://github.com/jschlight)             |
| Michael Dawson      | [mhdawson](https://github.com/mhdawson)               |
| Kevin Eady          | [KevinEady](https://github.com/KevinEady)
| Nicola Del Gobbo    | [NickNaso](https://github.com/NickNaso)               |

### <a name="emeritus"></a>Emeritus
| 名称                | GitHub 链接                                           |
| ------------------- | ----------------------------------------------------- |
| Arunesh Chandra     | [aruneshchandra](https://github.com/aruneshchandra)   |
| Benjamin Byholm     | [kkoopa](https://github.com/kkoopa)                   |
| Jason Ginchereau    | [jasongin](https://github.com/jasongin)               |
| Hitesh Kanwathirtha | [digitalinfinity](https://github.com/digitalinfinity) |
| Sampson Gao         | [sampsongao](https://github.com/sampsongao)           |
| Taylor Woll         | [boingoing](https://github.com/boingoing)             |

<a name="license"></a>

已通过 [MIT](./LICENSE.md) 许可

[ABI 稳定性指南]: https://nodejs.org/en/docs/guides/abi-stability/
[Node-API 支持矩阵]: https://nodejs.org/dist/latest/docs/api/n-api.html#n_api_n_api_version_matrix
