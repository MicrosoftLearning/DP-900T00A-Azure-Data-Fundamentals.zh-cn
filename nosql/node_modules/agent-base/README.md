---
ms.openlocfilehash: ca1f677bd38876befee833fcedd10388a71aecf4
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/05/2022
ms.locfileid: "138052972"
---
<a name="agent-base"></a>agent-base
==========
### <a name="turn-a-function-into-an-httpagenthttpagent-instance"></a>将函数转换为 [`http.Agent`][http.Agent] 实例
[![生成状态](https://github.com/TooTallNate/node-agent-base/workflows/Node%20CI/badge.svg)](https://github.com/TooTallNate/node-agent-base/actions?workflow=Node+CI)

该模块提供 `http.Agent` 生成器。 也就是说，你向它传递异步回调函数，它返回新的 `http.Agent` 实例，该实例将在发送出站 HTTP 请求时调用给定的回调函数。

#### <a name="some-subclasses"></a>部分子类：

以下是 `agent-base` 的一些相关用法。
发送拉取请求，列出你的用法！

 * [`http-proxy-agent`][http-proxy-agent]：HTTP 终结点的 HTTP 代理 `http.Agent` 实现
 * [`https-proxy-agent`][https-proxy-agent]：HTTPS 终结点的 HTTP 代理 `http.Agent` 实现
 * [`pac-proxy-agent`][pac-proxy-agent]：HTTP 和 HTTPS 的 PAC 文件代理 `http.Agent` 实现
 * [`socks-proxy-agent`][socks-proxy-agent]：HTTP 和 HTTPS 的 SOCKS 代理 `http.Agent` 实现


<a name="installation"></a>安装
------------

使用 `npm` 安装：

``` bash
$ npm install agent-base
```


<a name="example"></a>示例
-------

以下极简示例为每个 HTTP 请求（即相当于 `agent: false` 选项）新建与服务器的 `net.Socket` 连接：

```js
var net = require('net');
var tls = require('tls');
var url = require('url');
var http = require('http');
var agent = require('agent-base');

var endpoint = 'http://nodejs.org/api/';
var parsed = url.parse(endpoint);

// This is the important part!
parsed.agent = agent(function (req, opts) {
  var socket;
  // `secureEndpoint` is true when using the https module
  if (opts.secureEndpoint) {
    socket = tls.connect(opts);
  } else {
    socket = net.connect(opts);
  }
  return socket;
});

// Everything else works just like normal...
http.get(parsed, function (res) {
  console.log('"response" event!', res.headers);
  res.pipe(process.stdout);
});
```

还支持返回 Promise 或使用 `async` 函数：

```js
agent(async function (req, opts) {
  await sleep(1000);
  // etc…
});
```

返回另一个 `http.Agent` 实例，将该 HTTP 请求的责任“传递”给该代理：

```js
agent(function (req, opts) {
  return opts.secureEndpoint ? https.globalAgent : http.globalAgent;
});
```


<a name="api"></a>API
---

## <a name="agentfunction-callback-object-options--httpagent"></a>Agent(Function callback[, Object options]) → [http.Agent][]

创建基 `http.Agent`，它将为每个 HTTP 请求执行回调函数 `callback` 并用作其 `agent`。 回调函数负责创建某种类型的 `stream.Duplex` 实例，该实例将用作 HTTP 请求中的底层套接字。

`options` 对象接受以下属性：

  * `timeout` - 数字 - `callback()` 函数的超时（以毫秒为单位）。 默认为无穷大（可选）。

回调函数应具有以下签名：

### <a name="callbackhttpclientrequest-req-object-options-function-cb--undefined"></a>callback(http.ClientRequest req, Object options, Function cb) → undefined

可以访问 ClientRequest `req` 以读取请求标头和路径等。`options` 对象包含传递给 `http.request()`/`https.request()` 函数调用的选项，并且已设置格式以直接传递给 `net.connect()`/`tls.connect()`，否则建议创建套接字。 创建套接字后，将其传递给回调函数 `cb`，HTTP 请求将继续进行。

如果使用 `https` 模块调用 HTTP 请求，则 `options` 上的 `secureEndpoint` 属性将设置为 `true`。


<a name="license"></a>许可
-------

（MIT 许可证）

版权所有 (c) 2013 Nathan Rajlich &lt;nathan@tootallnate.net&gt;

特此免费授予获得此软件副本和相关文档文件（“软件”）的任何人员无限制处理软件的权利，包括但不限于使用、复制、修改、合并、发布、分发、分许可和/或销售软件副本，以及允许其他配备该软件的人员如此操作，需符合以下条件：

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

此软件按“原样”提供，无任何明示或暗示的保证，包括但不限于有关适销性、针对特定目的的适用性和不侵权的保证。
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

[http-proxy-agent]: https://github.com/TooTallNate/node-http-proxy-agent
[https-proxy-agent]: https://github.com/TooTallNate/node-https-proxy-agent
[pac-proxy-agent]: https://github.com/TooTallNate/node-pac-proxy-agent
[socks-proxy-agent]: https://github.com/TooTallNate/node-socks-proxy-agent
[http.Agent]: https://nodejs.org/api/http.html#http_class_http_agent
