---
ms.openlocfilehash: 10d69c50139d95dc37feaab872c5c2848fd3b089
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050606"
---
# <a name="buffer-travistravis-imagetravis-url-npmnpm-imagenpm-url-downloadsdownloads-imagedownloads-url-javascript-style-guidestandard-imagestandard-url"></a>缓冲区 [![travis][travis-image]][travis-url] [![npm][npm-image]][npm-url] [![下载][downloads-image]][downloads-url] [![javascript 风格指南][standard-image]][standard-url]

[travis-image]: https://img.shields.io/travis/feross/buffer/master.svg
[travis-url]: https://travis-ci.org/feross/buffer
[npm-image]: https://img.shields.io/npm/v/buffer.svg
[npm-url]: https://npmjs.org/package/buffer
[downloads-image]: https://img.shields.io/npm/dm/buffer.svg
[downloads-url]: https://npmjs.org/package/buffer
[standard-image]: https://img.shields.io/badge/code_style-standard-brightgreen.svg
[standard-url]: https://standardjs.com

#### <a name="the-buffer-module-from-nodejs-for-the-browser"></a>适用于浏览器的来自 [node.js](https://nodejs.org/) 缓冲区模块。

[![saucelabs][saucelabs-image]][saucelabs-url]

[saucelabs-image]: https://saucelabs.com/browser-matrix/buffer.svg
[saucelabs-url]: https://saucelabs.com/u/buffer

使用 [browserify](http://browserify.org)，只需 `require('buffer')` 或使用 `Buffer` 全局即可获取此模块。

目标是提供与 [node 的缓冲区 API](https://nodejs.org/api/buffer.html) 100% 相同的 API。 阅读[官方文档](https://nodejs.org/api/buffer.html)，获取支持的属性、实例方法和类方法的完整列表。

## <a name="features"></a>features

- 在所有浏览器中像老板一样操作二进制数据！
- 超级快。 由类型化数组（`Uint8Array`/`ArrayBuffer`，而不是 `Object`）提供支持
- 极小的捆绑包（缩小 6.75KB + gzip 压缩，带注释 51.9KB）
- 出色的浏览器支持（Chrome、Firefox、Edge、Safari 9+、IE 11、iOS 9+、Android 等）
- 完全保留 Node API，只有一个细微差异（见下文）
- 方括号 `buf[4]` 表示法有效！
- 请勿修改任何浏览器原型或在 `window` 上放置任何内容
- 全面测试套件（包括来自 node.js core 的所有缓冲区测试）

## <a name="install"></a>安装

若要直接使用此模块（而不使用 browserify），请安装它：

```bash
npm install buffer
```

此模块以前称为 native-buffer-browserify，但从现在开始请使用 buffer 。

如果不使用捆绑程序，可使用[独立脚本](https://bundle.run/buffer)。

## <a name="usage"></a>usage

模块的 API 与节点的 `Buffer` API 相同。 阅读[官方文档](https://nodejs.org/api/buffer.html)，获取支持的属性、实例方法和类方法的完整列表。

如上所述，`require('buffer')` 或将 `Buffer` 全局与 [browserify](http://browserify.org) 配合使用，此模块将自动包含在捆绑包中。 几乎任何 npm 模块在浏览器中都有效，即使它假定节点 `Buffer` API 将可用。

若要显式依赖于此模块（而不使用 browserify），需要如下操作：

```js
var Buffer = require('buffer/').Buffer  // note: the trailing slash is important!
```

若要显式需要此模块，请使用告知 node.js 模块查找算法的 `require('buffer/')`（浏览器也使用）以使用名为 `buffer` 的 npm 模块，而不是名为 `buffer` 的 node.js core 模块 ！


## <a name="how-does-it-work"></a>它是如何工作的？

Buffer 构造函数返回原型已更改为 `Buffer.prototype` 的 `Uint8Array` 的实例。 此外，`Buffer` 是 `Uint8Array` 的子类，因此返回的实例将具有所有节点 `Buffer` 方法和 `Uint8Array` 方法。 方括号表示法按预期工作 -- 返回单个八进制数。

`Uint8Array` 原型保持不变。


## <a name="tracking-the-latest-node-api"></a>跟踪最新的 Node API

本模块跟踪最新（不稳定）版本的 node.js 中的缓冲区 API。 缓冲区 API 在 **node 稳定性索引** 中被视为[稳定](https://nodejs.org/docs/latest/api/documentation.html#documentation_stability_index)，因此不太可能发生中断性变更。
尽管如此，如果缓冲区 API 在节点中发生变化时，此模块的 API 也会随之变化。

## <a name="related-packages"></a>相关包

- [`buffer-reverse`](https://www.npmjs.com/package/buffer-reverse) - 反转缓冲区
- [`buffer-xor`](https://www.npmjs.com/package/buffer-xor) - 对缓冲区执行按位异或
- [`is-buffer`](https://www.npmjs.com/package/is-buffer) - 确定对象是否为缓冲区而不包括整个 `Buffer` 包

## <a name="conversion-packages"></a>转换包

### <a name="convert-typed-array-to-buffer"></a>将类型化数组转换为缓冲区

使用 [`typedarray-to-buffer`](https://www.npmjs.com/package/typedarray-to-buffer) 将任何类型的类型化数组转换为 `Buffer`。 不执行副本，因此速度超快。

### <a name="convert-buffer-to-typed-array"></a>将缓冲区转换为类型化数组

`Buffer` 是 `Uint8Array`（类型化数组）的子类。 因此，无需显式转换为类型化数组。 只需将缓冲区用作 `Uint8Array`。

### <a name="convert-blob-to-buffer"></a>将 blob 转换为缓冲区

使用 [`blob-to-buffer`](https://www.npmjs.com/package/blob-to-buffer) 将 `Blob` 转换为 `Buffer`。

### <a name="convert-buffer-to-blob"></a>将缓冲区转换为 blob

若要将 `Buffer` 转换为 `Blob`，请使用 `Blob` 构造函数：

```js
var blob = new Blob([ buffer ])
```

（可选）指定 mimetype：

```js
var blob = new Blob([ buffer ], { type: 'text/html' })
```

### <a name="convert-arraybuffer-to-buffer"></a>将 arraybuffer 转换为 buffer

若要将 `ArrayBuffer` 转换为 `Buffer`，请使用 `Buffer.from` 函数。 不执行副本，因此速度超快。

```js
var buffer = Buffer.from(arrayBuffer)
```

### <a name="convert-buffer-to-arraybuffer"></a>将 buffer 转换为 arraybuffer

若要将 `Buffer` 转换为 `ArrayBuffer`，请使用 `.buffer` 属性（存在于所有 `Uint8Array` 对象上）：

```js
var arrayBuffer = buffer.buffer.slice(
  buffer.byteOffset, buffer.byteOffset + buffer.byteLength
)
```

或者使用 [`to-arraybuffer`](https://www.npmjs.com/package/to-arraybuffer) 模块。

## <a name="performance"></a>性能

请参阅 `/perf` 中的性能测试。

`BrowserBuffer` 是浏览器 `buffer` 模块（此存储库）。 `Uint8Array` 包含在健全性检查中（因为 `BrowserBuffer` 在幕后使用 `Uint8Array`，`Uint8Array` 将始终至少要快一点）。 最后，`NodeBuffer` 是 node.js 缓冲区模块，包含该模块以进行比较。

注意：自采取这些基准以来，性能有所提高。 PR 欢迎更新 README。

### <a name="chrome-38"></a>Chrome 38

| 方法 | 操作 | 精确度 | 抽样 | 最快 |
|:-------|:-----------|:---------|:--------|:-------:|
| BrowserBuffer#bracket-notation | 11,457,464 个操作/秒 | ±0.86% | 66 | ✓ |
| Uint8Array#bracket-notation | 10,824,332 个操作/秒 | ±0.74% | 65 | |
| | | | |
| BrowserBuffer#concat | 450,532 个操作/秒 | ±0.76% | 68 | |
| Uint8Array#concat | 1,368,911 个操作/秒 | ±1.50% | 62 | ✓ |
| | | | |
| BrowserBuffer#copy(16000) | 903,001 个操作/秒 | ±0.96% | 67 | |
| Uint8Array#copy(16000) | 1,422,441 个操作/秒 | ±1.04% | 66 | ✓ |
| | | | |
| BrowserBuffer#copy(16) | 11,431,358 个操作/秒 | ±0.46% | 69 | |
| Uint8Array#copy(16) | 13,944,163 个操作/秒 | ±1.12% | 68 | ✓ |
| | | | |
| BrowserBuffer#new(16000) | 106,329 个操作/秒 | ±6.70% | 44 | |
| Uint8Array#new(16000) | 131,001 个操作/秒 | ±2.85% | 31 | ✓ |
| | | | |
| BrowserBuffer#new(16) | 1,554,491 个操作/秒 | ±1.60% | 65 | |
| Uint8Array#new(16) | 6,623,930 个操作/秒 | ±1.66% | 65 | ✓ |
| | | | |
| BrowserBuffer#readDoubleBE | 112,830 个操作/秒 | ±0.51% | 69 | ✓ |
| DataView#getFloat64 | 93,500 个操作/秒 | ±0.57% | 68 | |
| | | | |
| BrowserBuffer#readFloatBE | 146,678 个操作/秒 | ±0.95% | 68 | ✓ |
| DataView#getFloat32 | 99,311 个操作/秒 | ±0.41% | 67 | |
| | | | |
| BrowserBuffer#readUInt32LE | 843,214 个操作/秒 | ±0.70% | 69 | ✓ |
| DataView#getUint32 | 103,024 个操作/秒 | ±0.64% | 67 | |
| | | | |
| BrowserBuffer#slice | 1,013,941 个操作/秒 | ±0.75% | 67 | |
| Uint8Array#subarray | 1,903,928 个操作/秒 | ±0.53% | 67 | ✓ |
| | | | |
| BrowserBuffer#writeFloatBE | 61,387 个操作/秒 | ±0.90% | 67 | |
| DataView#setFloat32 | 141,249 个操作/秒 | ±0.40% | 66 | ✓ |


### <a name="firefox-33"></a>Firefox 33

| 方法 | 操作 | 精确度 | 抽样 | 最快 |
|:-------|:-----------|:---------|:--------|:-------:|
| BrowserBuffer#bracket-notation | 20,800,421 个操作/秒 | ±1.84% | 60 | |
| Uint8Array#bracket-notation | 20,826,235 个操作/秒 | ±2.02% | 61 | ✓ |
| | | | |
| BrowserBuffer#concat | 153,076 个操作/秒 | ±2.32% | 61 | |
| Uint8Array#concat | 1,255,674 个操作/秒 | ±8.65% | 52 | ✓ |
| | | | |
| BrowserBuffer#copy(16000) | 1,105,312 个操作/秒 | ±1.16% | 63 | |
| Uint8Array#copy(16000) | 1,615,911 个操作/秒 | ±0.55% | 66 | ✓ |
| | | | |
| BrowserBuffer#copy(16) | 16,357,599 个操作/秒 | ±0.73% | 68 | |
| Uint8Array#copy(16) | 31,436,281 个操作/秒 | ±1.05% | 68 | ✓ |
| | | | |
| BrowserBuffer#new(16000) | 52,995 个操作/秒 | ±6.01% | 35 | |
| Uint8Array#new(16000) | 87,686 个操作/秒 | ±5.68% | 45 | ✓ |
| | | | |
| BrowserBuffer#new(16) | 252,031 个操作/秒 | ±1.61% | 66 | |
| Uint8Array#new(16) | 8,477,026 个操作/秒 | ±0.49% | 68 | ✓ |
| | | | |
| BrowserBuffer#readDoubleBE | 99,871 个操作/秒 | ±0.41% | 69 | |
| DataView#getFloat64 | 285,663 个操作/秒 | ±0.70% | 68 | ✓ |
| | | | |
| BrowserBuffer#readFloatBE | 115,540 个操作/秒 | ±0.42% | 69 | |
| DataView#getFloat32 | 288,722 个操作/秒 | ±0.82% | 68 | ✓ |
| | | | |
| BrowserBuffer#readUInt32LE | 633,926 个操作/秒 | ±1.08% | 67 | ✓ |
| DataView#getUint32 | 294,808 个操作/秒 | ±0.79% | 64 | |
| | | | |
| BrowserBuffer#slice | 349,425 个操作/秒 | ±0.46% | 69 | |
| Uint8Array#subarray | 5,965,819 个操作/秒 | ±0.60% | 65 | ✓ |
| | | | |
| BrowserBuffer#writeFloatBE | 59,980 个操作/秒 | ±0.41% | 67 | |
| DataView#setFloat32 | 317,634 个操作/秒 | ±0.63% | 68 | ✓ |

### <a name="safari-8"></a>Safari 8

| 方法 | 操作 | 精确度 | 抽样 | 最快 |
|:-------|:-----------|:---------|:--------|:-------:|
| BrowserBuffer#bracket-notation | 10,279,729 个操作/秒 | ±2.25% | 56 | ✓ |
| Uint8Array#bracket-notation | 10,030,767 个操作/秒 | ±2.23% | 59 | |
| | | | |
| BrowserBuffer#concat | 144,138 个操作/秒 | ±1.38% | 65 | |
| Uint8Array#concat | 4,950,764 个操作/秒 | ±1.70% | 63 | ✓ |
| | | | |
| BrowserBuffer#copy(16000) | 1,058,548 个操作/秒 | ±1.51% | 64 | |
| Uint8Array#copy(16000) | 1,409,666 个操作/秒 | ±1.17% | 65 | ✓ |
| | | | |
| BrowserBuffer#copy(16) | 6,282,529 个操作/秒 | ±1.88% | 58 | |
| Uint8Array#copy(16) | 11,907,128 个操作/秒 | ±2.87% | 58 | ✓ |
| | | | |
| BrowserBuffer#new(16000) | 101,663 个操作/秒 | ±3.89% | 57 | |
| Uint8Array#new(16000) | 22,050,818 个操作/秒 | ±6.51% | 46 | ✓ |
| | | | |
| BrowserBuffer#new(16) | 176,072 个操作/秒 | ±2.13% | 64 | |
| Uint8Array#new(16) | 24,385,731 个操作/秒 | ±5.01% | 51 | ✓ |
| | | | |
| BrowserBuffer#readDoubleBE | 41,341 个操作/秒 | ±1.06% | 67 | |
| DataView#getFloat64 | 322,280 个操作/秒 | ±0.84% | 68 | ✓ |
| | | | |
| BrowserBuffer#readFloatBE | 46,141 个操作/秒 | ±1.06% | 65 | |
| DataView#getFloat32 | 337,025 个操作/秒 | ±0.43% | 69 | ✓ |
| | | | |
| BrowserBuffer#readUInt32LE | 151,551 个操作/秒 | ±1.02% | 66 | |
| DataView#getUint32 | 308,278 个操作/秒 | ±0.94% | 67 | ✓ |
| | | | |
| BrowserBuffer#slice | 197,365 个操作/秒 | ±0.95% | 66 | |
| Uint8Array#subarray | 9,558,024 个操作/秒 | ±3.08% | 58 | ✓ |
| | | | |
| BrowserBuffer#writeFloatBE | 17,518 个操作/秒 | ±1.03% | 63 | |
| DataView#setFloat32 | 319,751 个操作/秒 | ±0.48% | 68 | ✓ |


### <a name="node-01114"></a>Node 0.11.14

| 方法 | 操作 | 精确度 | 抽样 | 最快 |
|:-------|:-----------|:---------|:--------|:-------:|
| BrowserBuffer#bracket-notation | 10,489,828 个操作/秒 | ±3.25% | 90 | |
| Uint8Array#bracket-notation | 10,534,884 个操作/秒 | ±0.81% | 92 | ✓ |
| NodeBuffer#bracket-notation | 10,389,910 个操作/秒 | ±0.97% | 87 | |
| | | | |
| BrowserBuffer#concat | 487,830 个操作/秒 | ±2.58% | 88 | |
| Uint8Array#concat | 1,814,327 个操作/秒 | ±1.28% | 88 | ✓ |
| NodeBuffer#concat | 1,636,523 个操作/秒 | ±1.88% | 73 | |
| | | | |
| BrowserBuffer#copy(16000) | 1,073,665 个操作/秒 | ±0.77% | 90 | |
| Uint8Array#copy(16000) | 1,348,517 个操作/秒 | ±0.84% | 89 | ✓ |
| NodeBuffer#copy(16000) | 1,289,533 个操作/秒 | ±0.82% | 93 | |
| | | | |
| BrowserBuffer#copy(16) | 12,782,706 个操作/秒 | ±0.74% | 85 | |
| Uint8Array#copy(16) | 14,180,427 个操作/秒 | ±0.93% | 92 | ✓ |
| NodeBuffer#copy(16) | 11,083,134 个操作/秒 | ±1.06% | 89 | |
| | | | |
| BrowserBuffer#new(16000) | 141,678 个操作/秒 | ±3.30% | 67 | |
| Uint8Array#new(16000) | 161,491 个操作/秒 | ±2.96% | 60 | |
| NodeBuffer#new(16000) | 292,699 个操作/秒 | ±3.20% | 55 | ✓ |
| | | | |
| BrowserBuffer#new(16) | 1,655,466 个操作/秒 | ±2.41% | 82 | |
| Uint8Array#new(16) | 14,399,926 个操作/秒 | ±0.91% | 94 | ✓ |
| NodeBuffer#new(16) | 3,894,696 个操作/秒 | ±0.88% | 92 | |
| | | | |
| BrowserBuffer#readDoubleBE | 109,582 个操作/秒 | ±0.75% | 93 | ✓ |
| DataView#getFloat64 | 91,235 个操作/秒 | ±0.81% | 90 | |
| NodeBuffer#readDoubleBE | 88,593 个操作/秒 | ±0.96% | 81 | |
| | | | |
| BrowserBuffer#readFloatBE | 139,854 个操作/秒 | ±1.03% | 85 | ✓ |
| DataView#getFloat32 | 98,744 个操作/秒 | ±0.80% | 89 | |
| NodeBuffer#readFloatBE | 92,769 个操作/秒 | ±0.94% | 93 | |
| | | | |
| BrowserBuffer#readUInt32LE | 710,861 个操作/秒 | ±0.82% | 92 | |
| DataView#getUint32 | 117,893 个操作/秒 | ±0.84% | 91 | |
| NodeBuffer#readUInt32LE | 851,412 个操作/秒 | ±0.72% | 93 | ✓ |
| | | | |
| BrowserBuffer#slice | 1,673,877 个操作/秒 | ±0.73% | 94 | |
| Uint8Array#subarray | 6,919,243 个操作/秒 | ±0.67% | 90 | ✓ |
| NodeBuffer#slice | 4,617,604 个操作/秒 | ±0.79% | 93 | |
| | | | |
| BrowserBuffer#writeFloatBE | 66,011 个操作/秒 | ±0.75% | 93 | |
| DataView#setFloat32 | 127,760 个操作/秒 | ±0.72% | 93 | ✓ |
| NodeBuffer#writeFloatBE | 103,352 个操作/秒 | ±0.83% | 93 | |

### <a name="iojs-181"></a>iojs 1.8.1

| 方法 | 操作 | 精确度 | 抽样 | 最快 |
|:-------|:-----------|:---------|:--------|:-------:|
| BrowserBuffer#bracket-notation | 10,990,488 个操作/秒 | ±1.11% | 91 | |
| Uint8Array#bracket-notation | 11,268,757 个操作/秒 | ±0.65% | 97 | |
| NodeBuffer#bracket-notation | 11,353,260 个操作/秒 | ±0.83% | 94 | ✓ |
| | | | |
| BrowserBuffer#concat | 378,954 个操作/秒 | ±0.74% | 94 | |
| Uint8Array#concat | 1,358,288 个操作/秒 | ±0.97% | 87 | |
| NodeBuffer#concat | 1,934,050 个操作/秒 | ±1.11% | 78 | ✓ |
| | | | |
| BrowserBuffer#copy(16000) | 894,538 个操作/秒 | ±0.56% | 84 | |
| Uint8Array#copy(16000) | 1,442,656 个操作/秒 | ±0.71% | 96 | |
| NodeBuffer#copy(16000) | 1,457,898 个操作/秒 | ±0.53% | 92 | ✓ |
| | | | |
| BrowserBuffer#copy(16) | 12,870,457 个操作/秒 | ±0.67% | 95 | |
| Uint8Array#copy(16) | 16,643,989 个操作/秒 | ±0.61% | 93 | ✓ |
| NodeBuffer#copy(16) | 14,885,848 个操作/秒 | ±0.74% | 94 | |
| | | | |
| BrowserBuffer#new(16000) | 109,264 个操作/秒 | ±4.21% | 63 | |
| Uint8Array#new(16000) | 138,916 个操作/秒 | ±1.87% | 61 | |
| NodeBuffer#new(16000) | 281,449 个操作/秒 | ±3.58% | 51 | ✓ |
| | | | |
| BrowserBuffer#new(16) | 1,362,935 个操作/秒 | ±0.56% | 99 | |
| Uint8Array#new(16) | 6,193,090 个操作/秒 | ±0.64% | 95 | ✓ |
| NodeBuffer#new(16) | 4,745,425 个操作/秒 | ±1.56% | 90 | |
| | | | |
| BrowserBuffer#readDoubleBE | 118,127 个操作/秒 | ±0.59% | 93 | ✓ |
| DataView#getFloat64 | 107,332 个操作/秒 | ±0.65% | 91 | |
| NodeBuffer#readDoubleBE | 116,274 个操作/秒 | ±0.94% | 95 | |
| | | | |
| BrowserBuffer#readFloatBE | 150,326 个操作/秒 | ±0.58% | 95 | ✓ |
| DataView#getFloat32 | 110,541 个操作/秒 | ±0.57% | 98 | |
| NodeBuffer#readFloatBE | 121,599 个操作/秒 | ±0.60% | 87 | |
| | | | |
| BrowserBuffer#readUInt32LE | 814,147 个操作/秒 | ±0.62% | 93 | |
| DataView#getUint32 | 137,592 个操作/秒 | ±0.64% | 90 | |
| NodeBuffer#readUInt32LE | 931,650 个操作/秒 | ±0.71% | 96 | ✓ |
| | | | |
| BrowserBuffer#slice | 878,590 个操作/秒 | ±0.68% | 93 | |
| Uint8Array#subarray | 2,843,308 个操作/秒 | ±1.02% | 90 | |
| NodeBuffer#slice | 4,998,316 个操作/秒 | ±0.68% | 90 | ✓ |
| | | | |
| BrowserBuffer#writeFloatBE | 65,927 个操作/秒 | ±0.74% | 93 | |
| DataView#setFloat32 | 139,823 个操作/秒 | ±0.97% | 89 | ✓ |
| NodeBuffer#writeFloatBE | 135,763 个操作/秒 | ±0.65% | 96 | |
| | | | |

## <a name="testing-the-project"></a>测试项目

首先安装项目：

    npm install

然后，若要在 Node.js 中运行测试，请运行：

    npm run test-node

若要在浏览器中进行本地测试，可以运行：

    npm run test-browser-es5-local # For ES5 browsers that don't support ES6
    npm run test-browser-es6-local # For ES6 compliant browsers

这会输出一个 URL，然后你可以在浏览器中将其打开，以使用 [airtap](https://www.npmjs.com/package/airtap) 运行测试。

若要使用 Saucelabs 运行自动化浏览器测试，请确保设置你的 `SAUCE_USERNAME` 和 `SAUCE_ACCESS_KEY` 环境变量，然后运行：

    npm test

这是在 Travis 中运行的内容，用于检查各种浏览器。 浏览器列表保留在 `bin/airtap-es5.yml` 和 `bin/airtap-es6.yml` 文件中。

## <a name="javascript-standard-style"></a>JavaScript 标准风格

本模块使用 [JavaScript 标准风格](https://github.com/feross/standard)。

[![JavaScript 风格指南](https://cdn.rawgit.com/feross/standard/master/badge.svg)](https://github.com/feross/standard)

若要测试代码是否符合风格，请使用 `npm install` 并运行：

    ./node_modules/.bin/standard

## <a name="credit"></a>额度

这最初是从 [buffer-browserify](https://github.com/toots/buffer-browserify) 创建分支的。

## <a name="security-policies-and-procedures"></a>安全策略和过程

`buffer` 团队和社区认真对待 `buffer` 中的所有安全 bug。 请参阅我们的[安全策略和过程](https://github.com/feross/security)文档，了解如何报告问题。

## <a name="license"></a>license

MIT. 版权 (C) [Feross Aboukhadijeh](http://feross.org) 和其他贡献者。 最初由 Romain Beauxis 从 MIT 许可模块创建分支。
