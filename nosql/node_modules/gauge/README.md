---
ms.openlocfilehash: 81fd1455668c9343defe69cbbbff10d48b1f97ef
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050917"
---
<a name="gauge"></a>gauge
=====

几乎无状态的基于终端的水平 gauge/进度栏。

```javascript
var Gauge = require("gauge")

var gauge = new Gauge()

gauge.show("test", 0.20)

gauge.pulse("this")

gauge.hide()
```

![](gauge-demo.gif)


### <a name="changes-from-1x"></a>从 1.x 开始的更改

gauge 2.x 为中断性发布，如果你此前是该模块的用户，请查看[更改日志]获取有关更改内容的详细信息。

[changelog]: CHANGELOG.md

### <a name="the-gauge-class"></a>gauge 类

这是模块的典型界面 - 它提供了一个漂亮的即发即弃界面来显示状态信息。

```
var Gauge = require("gauge")

var gauge = new Gauge([stream], [options])
```

* **stream** -（可选的默认 STDERR）要写入进度栏更新的流。  gauge 遵循反压，如果有指示，将暂停大多数写入。
* **options** -（可选）选项对象。

构造新的 gauge。 gauge 绘制在单行上，如果 stream 不是 tty 且未显式提供 tty，则不绘制 gauge。

如果 stream 是终端，或者如果将 tty 传递给 options，那么我们将对终端重设大小和重绘进行检测以实现适应  。  我们通过监视 tty 上的 `resize` 事件来执行此操作。  （为了解决 2.5.0 之前版本的 Node 中的 bug，如果 tty 是 stderr，我们会在 stdout 上对其进行监视。）重设到更大的窗口大小看起来会更加简洁，而缩小窗口总是会没那么整齐。

**重要提示：** 如果之前传入的是非 tty 流，但仍需要输出（例如，由 `ansi` 模块包装的流），那么需要传入下面的 tty 选项，因为 `gauge` 需要访问底层 tty 才能执行重设终端大小和终端宽度检测等操作。

**options** 对象可以具有以下属性，所有属性都是可选的：

* **updateInterval**：gauge 更新的频率，以毫秒为单位。
* **fixedFramerate**：在节点 0.8 上默认为 false，在其他所有节点上默认为 true。  如果为 true，则创建计时器以每 `updateInterval` 毫秒的频率触发一次，如果为 false，则会在更新传入时立即进行打印，但频率比 `updateInterval` 高的更新将被忽略。  节点 0.8 没有将此设置为 true 的原因是它无法 `unref` 其计时器，因此它会阻止程序退出 - 如果想在节点 0.8 中使用此功能，只需确保在程序退出之前调用 `gauge.disable()`。
* **themes**：选择要使用的主题时所需使用的主题集。 默认为 `gauge/themes`，有关详细信息，请参阅[主题] 文档。
* **theme**：选择要使用的主题，可以是：
  * 主题对象，在该情况下不使用 themes。
  * 主题的名称，将在当前的 themes 对象中进行查找。
  * 具有任意 `hasUnicode`、`hasColor` 或 `platform` 键的配置对象，用于在进行默认主题选择时替代我们的推荐主题。

  如果没有选择主题，那么将结合我们对你的操作系统、颜色支持和 unicode 支持的最佳推荐来选择默认主题。
* **template**：描述想要的 gauge 的外观。  默认为 npm 使用的模板。  详细[文档]在本文档后面。
* **hideCursor**：默认为 true。  如果为 true，则在显示 gauge 时隐藏光标。
* **tty**：最终要写入的 tty。  默认为与 stream 相同。  用于检测终端的宽度和重设大小。 使用的宽度为 `tty.columns - 1`。 如果没有可用的 tty，则假定宽度为 `79`。
* **enabled**：如果 `tty` 为 TTY，则默认为 true，否则为 false。  如果为 true，则开始启用 gauge。  如果禁用，则忽略所有更新命令，并且在调用 `.enable()` 之前不会打印任何 gauge。
* **Plumbing**：要使用的类，用于实际生成 gauge 以进行打印。  默认为 `require('gauge/plumbing')`，通常不需要进行替代。
* **cleanupOnExit**：默认为 true。 通常会注册一个退出处理程序，以确保在进程退出时（Ctrl+C 退出或以其他方式意外退出），光标重新打开并擦除进度栏。 你可以禁用此功能，并且不会注册退出处理程序。

[has-unicode]: https://www.npmjs.com/package/has-unicode
[主题]: #themes
[文档]: #templates

#### `gauge.show(section | status, [completed])`

第一个参数可以是节，即当前参与进度的内容的名称，可以是具有“节”、“子节”和“已完成”等键的对象（或在自定义模板中具有的任何其他类型）  。  如果不想更新或设置为任何这些内容，那么可以传递 `null` ，它将被忽略。

第二个参数是完成百分比，值介于 0 和 1 之间。
如果没有它，就不会更新为完成状态。 你还会注意到，完成可以作为状态对象的一部分，作为第一个参数传入。 如果传入它和已完成的参数，则会采用已完成的参数。

#### `gauge.hide([cb])`

从终端中删除 gauge。  （可选）在可以实现 IO 后回叫 `cb`（目前只在 `setImmediate` 回叫之后。）

事实证明，当你暂停一个文件句柄上的进度栏并打印到另一个文件句柄时，这一点很重要 – 否则（打印足够大）节点最终可能会将“结束进度栏”位打印到进度栏文件句柄，而其他内容会打印到另一个文件句柄。 这些交错可能会导致某些终端损坏。

#### `gauge.pulse([subsection])`

* **subsection** –（可选）触发此脉冲的特定内容

旋转 gauge 中的微调器以显示输出。  如果包含 subsection，那么它将与传递给 `gauge.show` 的姓氏组合在一起。

#### `gauge.disable()`

隐藏 gauge 并忽略对 `show` 或 `pulse` 的进一步调用。

#### `gauge.enable()`

显示 gauge 并在调用 `show` 或 `pulse` 时恢复更新。

#### `gauge.isEnabled()`

如果启用了 gauge，则返回 true。

#### `gauge.setThemeset(themes)`

更改主题集以从中选择主题。 与构造函数中使用的 `themes` 选项相同。 主题将在此主题集中重新进行选择。

#### `gauge.setTheme(theme)`

改变活动主题，将显示与下一次显示或脉冲。 这可以是：

* 主题对象，在该情况下不使用 themes。
* 主题的名称，将在当前的 themes 对象中进行查找。
* 具有任意 `hasUnicode`、`hasColor` 或 `platform` 键的配置对象，用于在进行默认主题选择时替代我们的推荐主题。

如果没有选择主题，那么将结合我们对你的操作系统、颜色支持和 unicode 支持的最佳推荐来选择默认主题。

#### `gauge.setTemplate(template)`

改变活动模板，将显示与下一次显示或脉冲

### <a name="tracking-completion"></a>跟踪完成状态

如果要跟踪多个内容的完成状态，那么相关的 [are-we-there-yet] 将会很有帮助。  它的 `change` 事件可以连接到 `show` 方法以获得更传统的进度栏界面。

[are-we-there-yet]: https://www.npmjs.com/package/are-we-there-yet

### <a name="themes"></a>主题

```
var themes = require('gauge/themes')

// fetch the default color unicode theme for this platform
var ourTheme = themes({hasUnicode: true, hasColor: true})

// fetch the default non-color unicode theme for osx
var ourTheme = themes({hasUnicode: true, hasColor: false, platform: 'darwin'})

// create a new theme based on the color ascii theme for this platform
// that brackets the progress bar with arrows
var ourTheme = themes.newTheme(theme(hasUnicode: false, hasColor: true}), {
  preProgressbar: '→',
  postProgressbar: '←'
})
```

`gauge/themes` 返回的对象是 `ThemeSet` 类的实例。

```
var ThemeSet = require('gauge/theme-set')
var themes = new ThemeSet()
// or
var themes = require('gauge/themes')
var mythemes = themes.newThemeset() // creates a new themeset based on the default themes
```

#### <a name="themesopts"></a>themes(opts)
#### <a name="themesgetdefaultopts"></a>themes.getDefault(opts)

主题对象是一个函数，基于平台、unicode 和颜色支持提取默认主题。

选项是包含以下属性的对象：

* **hasUnicode** - 如果为 true，则提取 unicode 主题，如果没有 unicode 主题可用，则使用非 unicode 主题。
* **hasColor** - 如果为 true，则提取颜色主题，如果没有颜色主题可用，则使用非颜色主题。
* **platform**（可选）- 默认为 `process.platform`。  如果没有可用的平台匹配项，则改为使用 `fallback`。

如果找不到兼容的主题，则会引发错误，`code` 为 `EMISSINGTHEME`。

#### <a name="themesaddthemethemename-themeobj"></a>themes.addTheme(themeName, themeObj)
#### <a name="themesaddthemethemename-parenttheme-newtheme"></a>themes.addTheme(themeName, [parentTheme], newTheme)

将命名主题添加到主题集。  可以传入由 `themes.newTheme` 返回的主题对象或传递给 `themes.newTheme` 的参数。

#### <a name="themesgetthemenames"></a>themes.getThemeNames()

返回此主题集中所有主题名称的列表。 适合在 `themes.getTheme(…)` 中使用。

#### <a name="themesgetthemename"></a>themes.getTheme(name)

从名为 `name` 的主题集中返回主题对象。

如果此主题集中不存在 `name`，则会引发错误，`code` 为 `EMISSINGTHEME`。

#### <a name="themessetdefaultopts-themename"></a>themes.setDefault([opts], themeName)

`opts` 是包含以下属性的对象。

* **platform** - 默认为 `'fallback'`。  如果主题特定于平台，请在此处使用来自 `process.platform` 的平台进行指定，例如 `win32`、`darwin` 等。
* **hasUnicode** - 默认为 `false`。 如果主题使用 unicode，则应将此属性设置为 true。
* **hasColor** - 默认为 `false`。  如果主题使用颜色，则应将此属性设置为 true。

`themeName` 是的主题名称（给定给 `addTheme`），用于此 `opts` 集。

#### <a name="themesnewthemeparenttheme-newtheme"></a>themes.newTheme([parentTheme,] newTheme)

基于 `parentTheme` 创建一个新的主题对象。  如果未提供 `parentTheme`，则将定义一个最小的 parentTheme，用于定义呈现活动指示器（微调器）和进度栏的函数。 （此后备父级在 `gauge/base-theme` 中定义。）

newTheme 应该是一个裸对象 - 首先讨论默认主题定义的属性：

* **preProgressbar** - 显示在进度栏之前（如果显示进度栏）。
* **postProgressbar** - 显示在进度栏之后（如果显示进度栏）。
* **progressBarTheme** - 传递到进度栏呈现器中的子主题，它是一个具有 `complete` 和 `remaining` 属性的对象，这些属性是你想要重复显示在进度栏的这些部分的字符串。
* **activityIndicatorTheme** - 活动指示器（微调器）的主题，可以是字符串（其中每个字符是不同的步骤），也可以是字符串数组。
* **preSubsection** - 在打印 `section` 和 `subsection` 时显示为分隔符。

在呈现模板时，主题通常可以具有任何有效值。 当主题中的属性名称与模板中的类型匹配时，将使用主题中的属性。 它们的值可以是：

* **strings & numbers** - 它们将按原样包含在内
* **function (values, theme, width)** - 应返回输出中所需的内容。
  values 是一个通过 `gauge.show` 提供的值的对象，theme 是特定于此项（见下文）或此主题对象的主题，而 width 是结果的字符数宽度  。

有几个特殊的前缀：

* **pre** - 显示在属性之前（如果显示）。
* **post** - 显示在属性之后（如果显示）。

以及一个特殊的后缀：

* **Theme** - 其值作为主题传递给函数类型项。

#### <a name="themesaddtoallthemestheme"></a>themes.addToAllThemes(theme)

这会将 `theme` 混合到当前定义的所有主题中。 还将其添加到此主题集的默认父主题中，因此添加到此主题集中的未来主题将默认从 `theme` 中获取值。

#### <a name="themesnewthemeset"></a>themes.newThemeset()

将当前主题集复制到新主题集。  这样，就可以轻松地从一个主题集继承到领一个主题集。

### <a name="templates"></a>模板

模板是对象和字符串的数组，在计算后，将转换为 gauge 行。  默认模板为：

```javascript
[
    {type: 'progressbar', length: 20},
    {type: 'activityIndicator', kerning: 1, length: 1},
    {type: 'section', kerning: 1, default: ''},
    {type: 'subsection', kerning: 1, default: ''}
]
```

各种模板元素可以是“纯字符串”，在这种情况下，它们将被逐字包含在输出中，也可以是具有以下属性的对象：

* type 可以是以下任一项，也可以是传入 `gauge.show` 的任何键，以及自定义主题上拥有的任何键。
  * `section` – 正在处理的内容。
  * `subsection` – 正在工作的内容的组件。
  * `activityIndicator` – 使用活动主题中的 `activityIndicatorTheme` 显示微调器。
  * `progressbar` – 使用当前主题中的 `progressbarTheme` 表示当前 `completed` 的进度栏。
* *kerning* – 则此项与其他项之间必须有的空格数（如果显示此项）。
* *maxLength* – 此元素的最大长度。 如果其值更长，则将被截断。
* *minLength* – 此元素的最小长度。 如果其值较短，将根据 align 值对其进行填充。
* *align* –（默认值：left）可能的值“left”、“right”和“center”。 按从字处理器的工作方式进行工作。
* *length* – 为 minLength 和 maxLength 提供单个值 。 如果同时指定了 length 和 *minLength 或 maxLength，则后者优先 。
* *value* – 要用于此模板项的文本值。
* *default* – 如果未传入值，则为此模板项使用的默认值。

### <a name="plumbing"></a>管道

非常简单的内部构件（无需假定任何内容，没有特别的功能），用于 gauge 实现其普通界面。

```
var Plumbing = require('gauge/plumbing')
var gauge = new Plumbing(theme, template, width)
```

* **theme**：要使用的主题。
* **template**：要使用的模板。
* **width**:gauge 的宽度

#### `gauge.setTheme(theme)`

更改活动主题。

#### `gauge.setTemplate(template)`

更改活动模板。

#### `gauge.setWidth(width)`

更改要呈现的宽度。

#### `gauge.hide()`

返回隐藏进度栏所需的字符串

#### `gauge.hideCursor()`

返回字符串以隐藏光标。

#### `gauge.showCursor()`

返回字符串以显示光标。

#### `gauge.show(status)`

使用 `status` 作为值，使用主题呈现提供的模板，并返回适合打印的字符串以更新 gauge。
