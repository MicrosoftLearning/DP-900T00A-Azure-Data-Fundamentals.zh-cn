---
ms.openlocfilehash: 34b661fbb1237d51bdab932626d19518225841a0
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050938"
---
<a name="are-we-there-yet"></a>are-we-there-yet
----------------

跟踪异步任务完成状态的复杂层次结构。  这旨在提供一种记录和报告大递归扇出进度的方法，并收集异步中常见的类型工作流。

如何使用此完成数据取决于你，但最常见的是将其馈送到一个进度条模块。

大多数进度条模块都包含基本版的该功能，但我的需求更复杂。

<a name="usage"></a>使用情况
=====

```javascript
var TrackerGroup = require("are-we-there-yet").TrackerGroup

var top = new TrackerGroup("program")

var single = top.newItem("one thing", 100)
single.completeWork(20)

console.log(top.completed()) // 0.2

fs.stat("file", function(er, stat) {
  if (er) throw er  
  var stream = top.newStream("file", stat.size)
  console.log(top.completed()) // now 0.1 as single is 50% of the job and is 20% complete
                              // and 50% * 20% == 10%
  fs.createReadStream("file").pipe(stream).on("data", function (chunk) {
    // do stuff with chunk
  })
  top.on("change", function (name) {
    // called each time a chunk is read from "file"
    // top.completed() will start at 0.1 and fill up to 0.6 as the file is read
  })
})
```

<a name="shared-methods"></a>共享方法
==============

* var completed = tracker.completed()

已实现的位置：`Tracker`、`TrackerGroup` 和 `TrackerStream`

返回已完成工作与待完成工作之比。 范围为 0 到 1。

* tracker.finish()

已实现的位置：`Tracker` 和 `TrackerGroup`

将跟踪器标记为已完成。 在 TrackerGroup 中，它可将其所有组件标记为已完成。

将此跟踪器的所有组件标记为已完成，这意味着它的 `tracker.completed()` 现在将为 1。

这将导致发出一个或多个 `change` 事件。

<a name="events"></a>事件
======

所有跟踪器对象都会发出带有以下参数的 `change` 事件：

```
function (name, completed, tracker)
```

`name` 是最初发出该事件的跟踪器的名称，或者在跟踪器没有名称的情况下，则为第一个包含具有名称的跟踪器组的跟踪器。

`completed` 是完成百分比（由 `tracker.completed()` 方法返回）。

`tracker` 是你正在侦听其事件的跟踪器对象。

<a name="trackergroup"></a>TrackerGroup
============

* var tracker = new TrackerGroup(name)

  * **名称** *（可选）* - 如果组件更新没有名称，则此跟踪器组的名称在更改通知中使用。 默认为未定义。

新建空的跟踪器聚合组。 这些跟踪器的完成状态由其他跟踪器的完成状态决定。

* tracker.addUnit(otherTracker, weight) 

  * **otherTracker** - 其他任何 are-we-there-yet 跟踪器对象
  * **权重** *（可选）* - 赋予跟踪器的权重，默认为 1。

将 otherTracker 添加到此聚合组。 权重决定该跟踪器相较于其他单位的预计完成时间。  例如，如果添加一个权重为 1 的跟踪器和一个权重为 2 的跟踪器，则第二个跟踪器的完成时间是第一个跟踪器的两倍。  因此，第一个跟踪器将占该跟踪器完成时间的 33%，第二个将占 67%。

返回 otherTracker。

* var subGroup = tracker.newGroup(name, weight) 

以上完全等效于：

```javascript
  var subGroup = tracker.addUnit(new TrackerGroup(name), weight)
```

* var subItem = tracker.newItem(name, todo, weight)  

以上完全等效于：

```javascript
  var subItem = tracker.addUnit(new Tracker(name, todo), weight)
```

* var subStream = tracker.newStream(name, todo, weight)  

以上完全等效于：

```javascript
  var subStream = tracker.addUnit(new TrackerStream(name, todo), weight)
```

* console.log( tracker.debug() )

返回一个树，显示此跟踪器组及其所有子级的完成情况，包括以递归方式输入所有子级。

<a name="tracker"></a>Tracker
=======

* var tracker = new Tracker(name, todo) 

  * **名称** *（可选）* ：要在更改事件中报告的该计数器的名称。  默认为未定义。
  * **待办事项** *（可选）* ：待办事项的数量（数字）。 默认值为 0。

通常，这些会构建为跟踪器组的一部分（通过 `newItem`）。

* var completed = tracker.completed()

返回已完成工作与待完成工作之比。 范围为 0 到 1。 如果总的待完成工作为 0，则它将返回 0。

* tracker.addWork(todo)

  * **待办事项**：增加到待完成工作数量的数字。

增加待完成工作量，从而降低完成百分比。  触发 `change` 事件。

* tracker.completeWork(completed)

  * **已完成**：添加到已完成工作的数字

增加已完成工作量，从而提高完成百分比。
已完成工作量永远不超过待办事项工作量。 也就是说，不允许百分比 > 100%。 触发 `change` 事件。

* tracker.finish()

将此跟踪器标记为已完成，tracker.completed() 现在将为 1。 触发 `change` 事件。

<a name="trackerstream"></a>TrackerStream
=============

* var tracker = new TrackerStream(name, size, options)  

  * **名称** *（可选）* ：要在更改事件中报告的该计数器的名称。  默认为未定义。
  * **大小** *（可选）* ：通过此流发送的字节数。
  * **选项** *（可选）* ：流选项的哈希

跟踪器流对象是一个传递流，可在每次块传递时更新内部的跟踪器对象。  它旨在跟踪下载、文件提取和其他相关活动。 你可以将数据源导入其中，然后将其用作数据源。

如果数据具有长度属性，则该属性在传递区块时用作已完成工作量。  如果不具有（例如对象流），则每个区块算作完成 1 项工作，因此大小应是正在流式传输的对象的总数。

* tracker.addWork(todo)

  * **待办事项**：将预期的整体大小增加“待办事项”字节。

增加待完成工作量，从而降低完成百分比。  触发 `change` 事件。
