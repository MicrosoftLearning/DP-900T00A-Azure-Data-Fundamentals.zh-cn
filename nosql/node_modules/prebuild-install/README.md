---
ms.openlocfilehash: 50690c00791b1f6ca1d585c1fb653f0ec4794578
ms.sourcegitcommit: e739004291428ce83f14b9d49f1e9dfaa3762dde
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/05/2022
ms.locfileid: "138050813"
---
# <a name="prebuild-install"></a>prebuild-install

> **一个命令行工具，用于在特定平台上轻松安装多个版本的 Node.js 和 Electron 的预生成二进制文件。**
> 默认情况下，它会从 GitHub 版本下载预生成的二进制文件。

[![npm](https://img.shields.io/npm/v/prebuild-install.svg)](https://www.npmjs.com/package/prebuild-install)
![Node 版本](https://img.shields.io/node/v/prebuild-install.svg)
[![测试](https://github.com/prebuild/prebuild-install/actions/workflows/test.yml/badge.svg)](https://github.com/prebuild/prebuild-install/actions/workflows/test.yml)
[![david](https://david-dm.org/prebuild/prebuild-install.svg)](https://david-dm.org/prebuild/prebuild-install)
[![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg)](http://standardjs.com/)

## <a name="note"></a>注意

**我们建议 [`prebuildify`](https://github.com/prebuild/prebuildify) 和 [`node-gyp-build`](https://github.com/prebuild/node-gyp-build) 配对，而不是 [`prebuild`](https://github.com/prebuild/prebuild) 和 [`prebuild-install`](https://github.com/prebuild/prebuild-install) 配对**

对于 `prebuildify`，所有预生成的二进制文件都随附在发布到 npm 的包中，这意味着无需要像在 `prebuild` 中那样执行单独的下载步骤。 这种方法的讽刺之处在于，当它们被捆绑在一起时，下载每个平台的所有预生成的二进制文件比下载单个预生成的二进制文件作为安装脚本要快得多。

优点：

1. 无需额外的下载步骤，使其更可靠，安装更快。
2. 支持在本地更改运行时版本，并在 Node.js 和 Electron 之间使用相同的安装。 不需要重新安装或重新生成，因为所有预生成的二进制文件都在 npm tarball 中，并且在运行时会正确做出选择。
3. `node-gyp-build` 运行时依赖项是无依赖项的，并且在原则上仍然如此，因为引入依赖项会抵消较短的安装时间。
4. 即使禁用 npm 安装脚本，预生成的二进制文件也能正常工作。
5. npm 包校验和也涵盖预生成的二进制文件。

缺点：

1. 在磁盘上安装的 npm 包更大。 使用 [Node-API](https://nodejs.org/api/n-api.html) 可以缓解这种情况，因为 Node-API 二进制文件与运行时无关且向前兼容。
2. 发布过程略微复杂，因为 `npm publish` 必须在编译和提取预生成的二进制文件之后执行（通常在 CI 中）。

## <a name="usage"></a>使用情况

使用 [`prebuild`](https://github.com/prebuild/prebuild) 创建和上传预生成的二进制文件。 然后更改 package.json 安装脚本：

```json
{
  "scripts": {
    "install": "prebuild-install || node-gyp rebuild"
  }
}
```

### <a name="help"></a>帮助

```
prebuild-install [options]

  --download    -d  [url]       (download prebuilds, no url means github)
  --target      -t  version     (version to install for)
  --runtime     -r  runtime     (Node runtime [node, napi or electron] to build or install for, default is node)
  --path        -p  path        (make a prebuild-install here)
  --token       -T  gh-token    (github token for private repos)
  --arch            arch        (target CPU architecture, see Node OS module docs, default is current arch)
  --platform        platform    (target platform, see Node OS module docs, default is current platform)
  --tag-prefix <prefix>         (github tag prefix, default is "v")
  --build-from-source           (skip prebuild download)
  --verbose                     (log verbosely)
  --libc                        (use provided libc rather than system default)
  --debug                       (set Debug or Release configuration)
  --version                     (print prebuild-install version and exit)
```

通过 `npm` 脚本运行 `prebuild-install` 时，选项 `--build-from-source`、`--debug`、`--download`、`--target`、`--runtime`、`--arch` 和 `--platform` 可以通过提供给 `npm` 命令的参数进行传递。

也可以设置环境变量 `npm_config_build_from_source=true`、`npm_config_platform`、`npm_config_arch`、`npm_config_target` 和 `npm_config_runtime`。

### <a name="private-repositories"></a>专用存储库

`prebuild-install` 支持使用 `-T <github-token>` 从专用 GitHub 存储库下载预生成文件：

```
$ prebuild-install -T <github-token>
```

如果不想在 cli 中使用令牌，可以将其放在 `~/.prebuild-installrc` 中：

```
token=<github-token>
```

也可以在 `prebuild-install_token` 环境变量中指定它。

请注意，通过使用 GitHub 令牌来使用 API 解析正确的版本，这意味着你受到 [GitHub 速率限制](https://developer.github.com/v3/rate_limit/)的约束。

### <a name="create-github-token"></a>创建 GitHub 令牌

创建令牌：

- 转到此[页面](https://github.com/settings/tokens)
- 单击 `Generate new token` 按钮
- 为令牌命名并单击 `Generate token` 按钮，如下所示

![prebuild-token](https://cloud.githubusercontent.com/assets/13285808/20844584/d0b85268-b8c0-11e6-8b08-2b19522165a9.png)

默认范围应正常。

### <a name="custom-binaries"></a>自定义二进制文件

最终用户可以通过 .npmrc 文件中的环境变量替代二进制下载位置。
变量需要满足掩码 `% your package name %_binary_host` 或 `% your package name %_binary_host_mirror`。 例如：

```
leveldown_binary_host=http://overriden-host.com/overriden-path
```

请注意，仍将追加包版本子路径和文件名。
因此，如果要安装 `leveldown@1.2.3`，最终的 URL 将是：

```
http://overriden-host.com/overriden-path/v1.2.3/leveldown-v1.2.3-node-v57-win32-x64.tar.gz
```

#### <a name="local-prebuilds"></a>本地的预生成文件

如果要使用本地文件系统中的预生成文件，可以使用 `% your package name %_local_prebuilds` .npmrc 变量设置包含预生成的文件夹的路径。 例如：

```
leveldown_local_prebuilds=/path/to/prebuilds
```

此选项将直接在该文件夹中查找使用 `prebuild` 创建的捆绑包，例如：

```
/path/to/prebuilds/leveldown-v1.2.3-node-v57-win32-x64.tar.gz
```

非绝对路径相对于调用预生成安装的包的目录解析，例如对于嵌套依赖项。

### <a name="cache"></a>缓存

所有预生成的二进制文件都将被缓存，以最大程度地减少流量。 因此，`prebuild-install` 首先从缓存中选择二进制文件，如果找不到二进制文件，就会下载它。 根据环境，缓存文件夹按以下顺序确定：

- `${npm_config_cache}/_prebuilds`
- `${APP_DATA}/npm-cache/_prebuilds`
- `${HOME}/.npm/_prebuilds`

## <a name="license"></a>许可

MIT
