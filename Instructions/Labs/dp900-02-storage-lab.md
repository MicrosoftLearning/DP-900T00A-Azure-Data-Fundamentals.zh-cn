---
lab:
  title: 探索 Azure 存储
  module: Explore Azure Storage for non-relational data
---

# <a name="explore-azure-storage"></a>探索 Azure 存储

在本练习中，你将在 Azure 订阅中预配一个 Azure 存储帐户，并探索可以使用它来存储数据的各种方式。

完成本实验室大约需要 15 分钟。

## <a name="before-you-start"></a>开始之前

需要一个你在其中具有管理级权限的 [Azure 订阅](https://azure.microsoft.com/free)。

## <a name="provision-an-azure-storage-account"></a>预配 Azure 存储帐户

使用 Azure 存储的第一步是在 Azure 订阅中预配 Azure 存储帐户。

1. 如果你还没有完成此操作，请登录 [Azure 门户](https://portal.azure.com?azure-portal=true)。
1. 在 Azure 门户主页的左上角，选择“&#65291; 创建资源”，并搜索“存储帐户”。 然后在出现的“存储帐户”页中，选择“创建”。
1. 在“创建存储帐户”页上，输入以下值：
    - **订阅**：选择 Azure 订阅。
    - 资源组：使用所选名称创建新资源组。
    -               存储帐户名称：使用小写字母和数字输入存储帐户的唯一名称。
    - 区域：选择任何可用位置。
    -               性能：标准
    -               冗余：本地冗余存储 (LRS)

1. 选择“下一步: 高级 >”以查看高级配置选项。 特别要注意的是，可在此处启用分层命名空间，以支持 Azure Data Lake Storage Gen2。 将此选项保留为<u>“未选中”</u>状态（稍后会启用），然后选择“下一步: 网络 >”以查看存储帐户的网络选项。 
1. 选择“下一步: 数据保护 >”，然后在“恢复”部分中，<u>取消</u>选中所有“启用软删除...”选项。   这些选项会保留已删除的文件以供后续恢复，但以后当你启用分层命名空间时，可能会导致问题。
1. 继续转到其余的“下一步 >”页面，不更改任何默认设置，然后在“查看 + 创建”页上，等待你的选择通过验证，然后选择“创建”以创建 Azure 存储帐户。  
1. 等待部署完成。 然后，转到已部署的资源。

## <a name="explore-blob-storage"></a>了解 Blob 存储

现在，你已有一个 Azure 存储帐户，可以为 blob 数据创建容器。

1. 从 `https://aka.ms/product1.json` 下载 [product1.json](https://aka.ms/product1.json?azure-portal=true) JSON 文件，并将它保存在你的计算机上（可以将它保存在任何文件夹中 - 稍后将它上传到 Blob 存储）。

                  如果浏览器中显示了 JSON 文件，请将该页另存为 product1.json。

1. 在存储容器的“Azure 门户”页左侧的“数据存储”部分中，选择“容器”。
1. 在“容器”页中，选择“&#65291; 容器”，然后添加一个名为 data 的新容器，其公共访问级别为“专用(不允许匿名访问)”   。
1. 创建“data”容器后，验证它是否在“容器”页中列出。
1. 在左侧窗格的顶部，选择“存储浏览器”。 此页提供一个基于浏览器的界面，可用于处理存储帐户中的数据。
1. 在“存储浏览器”页中，选择“Blob 容器”，然后验证是否已列出“data”容器。
1. 选择“data”容器，注意它是空的。
1. 选择“&#65291; 添加目录”，阅读有关文件夹的信息，然后创建名为 products 的新目录 。
1. 在存储浏览器中，验证当前视图是否显示刚刚创建的“products”文件夹的内容，观察页面顶部的“痕迹导航”是否反映了路径“Blob 容器”>“data”>“products” 。
1. 在痕迹导航中，选择“data”以切换到“data”容器，注意它<u>不</u>包含名为“products”的文件夹。

    Blob 存储中的文件夹是虚拟文件夹，仅作为 blob 路径的一部分存在。 由于“products”文件夹不包含任何 blob，所以它并不真正存在！

1. 使用“&#10514; 上传”按钮打开“上传 blob”面板。 
1. 在“上传 blob”面板中，选择先前保存在本地计算机上的 product1.json 文件。 然后，在“高级”部分的“上传到文件夹”框中，输入 product_data 并选择“上传”按钮。
1. 如果“上传 blob”面板仍处于打开状态，请将其关闭，并验证是否已在“data”容器中创建 product_data 虚拟文件夹。
1. 选择 product_data 文件夹，并验证它是否包含已上传的 product1.json blob。
1. 在左侧的“数据存储”部分中，选择“容器”。
1. 打开“data”容器，并验证是否已列出你创建的 product_data 文件夹。
1. 选择文件夹右端的 &#x2027;&#x2027;&#x2027; 图标，注意它不显示任何选项。 平面命名空间 Blob 容器中的文件夹是虚拟文件夹，不能进行管理。
1. 使用“data”页右上角的“X”图标关闭页面并返回到“容器”页。

## <a name="explore-azure-data-lake-storage-gen2"></a>了解 Azure Data Lake Storage Gen2

Azure Data Lake Storage Gen2 支持使你能够使用分层文件夹来组织和管理对 blob 的访问。 它还使你能够使用 Azure Blob 存储来托管用于常见大数据分析平台的分布式文件系统。

1. 从 `https://aka.ms/product2.json` 下载 [product2.json](https://aka.ms/product2.json?azure-portal=true) JSON 文件，并将它保存在你的计算机上（之前下载 product1.json 的同一文件夹中 - 稍后将它上传到 Blob 存储）。
1. 在存储账户的“Azure 门户”页的左侧，向下滚动到“设置”部分，然后选择“Data Lake Gen2 升级” 。
1. 在“Data Lake Gen2 升级”页上，展开并完成每个步骤以升级存储帐户，从而启用分层命名空间并支持 Azure Data Lake Storage Gen2。 这可能需要一些时间。
1. 升级完成后，在左侧窗格中的顶部，选择“存储浏览器”，然后导航回 data Blob 容器的根目录，其中仍包含 product_data 文件夹。  
1. 选择 product_data 文件夹，并确认它仍包含之前上传的 product1.json 文件。
1. 使用“&#10514; 上传”按钮打开“上传 blob”面板。 
1. 在“上传 blob”面板中，选择保存在本地计算机上的 product2.json 文件。 然后选择“上传”按钮。
1. 如果“上传 blob”面板仍处于打开状态，请将其关闭，并验证 product_data 文件夹现在是否包含 product2.json 文件。
1. 在左侧的“数据存储”部分中，选择“容器”。
1. 打开“data”容器，并验证是否已列出你创建的 product_data 文件夹。
1. 选择文件夹右端的 &#x2027;&#x2027;&#x2027; 图标，并注意在启用分层命名空间后，你可以在文件夹级别执行配置任务；包括重命名文件夹和设置权限。
1. 使用“data”页右上角的“X”图标关闭页面并返回到“容器”页。

## <a name="explore-azure-files"></a>了解 Azure 文件存储

Azure 文件存储为创建基于云的文件共享提供了一种方法。

1. 在存储容器的“Azure 门户”页左侧的“数据存储”部分中，选择“文件共享”。
1. 在“文件共享”页中，选择“&#65291; 文件共享”，并使用“事务优化”层添加名为 files 的新文件共享  。
1. 在“文件共享”中，打开新的“文件”共享。
1. 在页面顶部，选择“连接”。 然后，在“连接”窗格中，注意有常见操作系统（Windows、Linux 和 macOS）的选项卡，其中包含可运行以从客户端计算机连接到共享文件夹的脚本。
1. 关闭“连接”窗格，然后关闭“文件”页以返回到 Azure 存储帐户的“文件共享”页。

## <a name="explore-azure-tables"></a>了解 Azure 表

Azure 表为需要存储数据值但不需要关系数据库的完整功能和结构的应用程序提供了键/值存储。

1. 在存储容器的“Azure 门户”页左侧的“数据存储”部分中，选择“表”。
1. 在“表”页上，选择“&#65291; 表”并创建名为 products 的新表。  
1. 创建 products 表后，在左侧窗格的顶部，选择“存储浏览器” 。
1. 在存储资源管理器中，选择“表”并验证是否已列出“products”表。
1. 选择“products”表。
1. 在 products 页中，选择“&#65291;添加实体” 。
1. 在“添加实体”面板中，输入以下键值：
    -               PartitionKey：1
    -               RowKey：1
1. 选择“添加属性”，然后创建一个具有以下值的新属性：

    |属性名称 | 类型 | 值 |
    | ------------ | ---- | ----- |
    | 名称 | String | 小组件 |

1. 添加具有以下值的第二个属性：

    |属性名称 | 类型 | 值 |
    | ------------ | ---- | ----- |
    | 价格 | Double | 2.99 |

1. 选择“插入”，将新实体的行插入表中。
1. 在存储浏览器中，验证是否已向“products”表添加行，并且是否已创建“Timestamp”列来指示上次修改该行的时间。
1. 使用以下属性将另一个实体添加到“products”表中：

    |属性名称 | 类型 | 值 |
    | ------------ | ---- | ----- |
    | PartitionKey | 字符串 | 1 |
    | RowKey | 字符串 | 2 |
    | 名称 | String | Kniknak |
    | 价格 | Double | 1.99 |
    | 已中断 | 布尔 | 是 |

1. 插入新实体后，验证表中是否显示了包含已停用产品的行。

    你已使用存储浏览器界面将数据手动输入到表中。 在实际场景中，应用程序开发人员可以使用 Azure 存储表 API 生成可读取表值和向表写入值的应用程序，这使得它成为 NoSQL 存储的经济高效且可缩放的解决方案。

> 提示：如果已完成浏览 Azure 存储，则可以删除在本练习中创建的资源组。
